this.nlpjs=this.nlpjs||{},this.nlpjs.Ner=function(t){"use strict";var e=class{constructor(t,e,s,r,i){this.s_size=t.length,this.s=t,this.substring_i=e,this.result=s,this.method=r,this.instance=i}};const s="\\ud800-\\udfff",r="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\u1ab0-\\u1aff\\u1dc0-\\u1dff",i="\\ufe0e\\ufe0f",n=`[${s}]`,u=`[${r}]`,o="\\ud83c[\\udffb-\\udfff]",a=`[^${s}]`,c="(?:\\ud83c[\\udde6-\\uddff]){2}",l="[\\ud800-\\udbff][\\udc00-\\udfff]",h="\\u200d",g=`${`(?:${u}|${o})`}?`,f=`[${i}]?`,d=f+g+`(?:${h}(?:${[a,c,l].join("|")})${f+g})*`,p=`(?:${[`${a}${u}?`,u,c,l,n].join("|")})`,m=RegExp(`[${h+s+r+i}]`),D=RegExp(`${o}(?=${o})|${p+d}`,"g"),y=t=>m.test(t),F=t=>t.match(D)||[],A=t=>t.split("");var C={hasUnicode:y,unicodeToArray:F,asciiToArray:A,stringToArray:t=>y(t)?F(t):A(t),compareWildcars:function(t,e){const s=`^${e.split("*").map((t=>t.replace(/([.*+^=!:${}()|[\]/\\])/g,"\\$1"))).join(".*")}$`.replace(/\?/g,".");return new RegExp(s).test(t)},loadEnvFromJson:function(t,e={}){const s=Object.keys(e);t=t?`${t}_`:"";for(let r=0;r<s.length;r+=1){const i=`${t}${s[r]}`;process.env[i]=e[s[r]]}}};var E=class{constructor(t){this.container=t.container||t,this.name="default"}getTokenFromWord(t){return t.startsWith("//")?{type:"comment",value:t}:["set","delete","get","inc","dec","eq","neq","gt","ge","lt","le","label","goto","jne","je"].includes(t)?{type:t,arguments:[]}:t.startsWith("$")?{type:"call",value:t.slice(1)}:{type:"reference",value:t}}compile(t){const e=[];for(let s=0;s<t.length;s+=1){const r=t[s].trim().split(" "),i=[];let n,u="";for(let t=0;t<r.length;t+=1){const e=r[t];let s=!1;n?(u=`${u} ${e}`,s=!0,e.endsWith(n)&&(n=void 0,i.push(this.getTokenFromWord(u)))):e.startsWith('"')?(u=e,s=!0,n='"',e.endsWith('"')&&(n=void 0,i.push(this.getTokenFromWord(u)))):e.startsWith("'")&&(u=e,s=!0,n="'",e.endsWith("'")&&(n=void 0,i.push(this.getTokenFromWord(u)))),s||i.push(this.getTokenFromWord(e))}e.push(i)}return e}executeCall(t,e,s,r,i){const n=this.container.getPipeline(t.value);if(!n)throw new Error(`Pipeline $${t.value} not found.`);return this.container.runPipeline(n,s,r,i+1)}executeReference(t,e,s,r,i){const n=this.container.resolvePath(e.value,s,r,i),u=[];for(let e=1;e<t.length;e+=1)u.push(this.container.resolvePathWithType(t[e].value,s,r,i));if(!n)throw new Error(`Method not found for step ${JSON.stringify(t)}`);const o=n.run||n;return"function"==typeof o?"function"==typeof n?o(r,...u):o.bind(n)(r,...u):o}doGoto(t,e){const s=e,r=s.labels[t];s.cursor=r}async executeAction(t,e,s,r,i){let n=t[0];if(n&&n.value&&n.value.startsWith("->")){if(i>0)return s;n={...n},n.value=n.value.slice(2)}switch(n.type){case"set":this.container.setValue(t[1].value,t[2]?t[2].value:void 0,e,s,r);break;case"delete":this.container.deleteValue(t[1].value,e,s,r);break;case"get":return this.container.getValue(t[1]?t[1].value:void 0,e,s,r);case"inc":this.container.incValue(t[1]?t[1].value:void 0,t[2]?t[2].value:"1",e,s,r);break;case"dec":this.container.decValue(t[1]?t[1].value:void 0,t[2]?t[2].value:"1",e,s,r);break;case"eq":this.container.eqValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,s,r);break;case"neq":this.container.neqValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,s,r);break;case"gt":this.container.gtValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,s,r);break;case"ge":this.container.geValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,s,r);break;case"lt":this.container.ltValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,s,r);break;case"le":this.container.leValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,s,r);break;case"goto":this.doGoto(t[1].value,e);break;case"jne":e.floating||this.doGoto(t[1].value,e);break;case"je":e.floating&&this.doGoto(t[1].value,e);break;case"call":return this.executeCall(n,e,s,r,i);case"reference":return this.executeReference(t,n,e,s,r)}return s}findLabels(t,e){const s=e;for(let e=0;e<t.length;e+=1){const r=t[e];"label"===r[0].type&&(s[r[1].value]=e)}}async execute(t,e,s,r){let i=e;const n={cursor:0,labels:{}};for(this.findLabels(t,n.labels);n.cursor<t.length;)i=await this.executeAction(t[n.cursor],n,i,s,r),n.cursor+=1;return i}};var x=new class{constructor(){this.name="logger"}debug(...t){console.debug(...t)}info(...t){console.info(...t)}warn(...t){console.warn(...t)}error(...t){console.error(...t)}log(...t){console.log(...t)}trace(...t){console.trace(...t)}fatal(...t){console.error(...t)}};const{compareWildcars:B}=C;class b{constructor(t=!1){this.classes={},this.factory={},this.pipelines={},this.configurations={},this.compilers={},this.cache={bestKeys:{},pipelines:{}},this.registerCompiler(E),t||this.use(x)}registerCompiler(t,e){const s=new t(this);this.compilers[e||s.name]=s}addClass(t,e){this.classes[e||t.name]=t}toJSON(t){const e=t.toJSON?t.toJSON():{...t};return e.className=t.constructor.name,e}fromJSON(t,e){const s=this.classes[t.className];let r;return s?(r=new s(e),r.fromJSON?r.fromJSON(t):Object.assign(r,t)):r={...t},delete r.className,r}register(t,e,s=!0){this.cache.bestKeys={};const r="function"==typeof e,i={name:t,isSingleton:s};i.instance=s?r?new e:e:r?e:e.constructor,this.factory[t]=i}getBestKey(t){if(void 0!==this.cache.bestKeys[t])return this.cache.bestKeys[t];const e=Object.keys(this.factory);for(let s=0;s<e.length;s+=1)if(B(t,e[s]))return this.cache.bestKeys[t]=e[s],e[s];this.cache.bestKeys[t]=null}get(t,e){let s=this.factory[t];if(!s){if(this.parent)return this.parent.get(t,e);const r=this.getBestKey(t);if(r&&(s=this.factory[r]),!s)return}if(s.isSingleton)return s.instance&&s.instance.applySettings&&s.instance.applySettings(s.instance.settings,e),s.instance;return new(0,s.instance)(e,this)}buildLiteral(t,e,s,r){return{type:"literal",subtype:t,src:e,value:s,context:r,container:this}}resolvePathWithType(t,e,s,r){const i=t.split(".");let n=i[0].trim();n||(n=t.startsWith(".")?"this":"context");if(/^\d+$/.test(n))return this.buildLiteral("number",t,parseFloat(n),e);if(n.startsWith('"'))return this.buildLiteral("string",t,n.replace(/^"(.+(?="$))"$/,"$1"),e);if(n.startsWith("'"))return this.buildLiteral("string",t,n.replace(/^'(.+(?='$))'$/,"$1"),e);if("true"===n)return this.buildLiteral("boolean",t,!0,e);if("false"===n)return this.buildLiteral("boolean",t,!1,e);let u=e;"input"===n||"output"===n?u=s:n&&"context"!==n&&"this"!==n?u=this.get(n)||u[n]:"this"===n&&(u=r);for(let e=1;e<i.length;e+=1){const s=i[e];if((!u||!u[s])&&e<i.length-1)throw Error(`Path not found in pipeline "${t}"`);const r=u;u=u[s],"function"==typeof u&&(u=u.bind(r))}return"function"==typeof u?{type:"function",src:t,value:u,context:e,container:this}:{type:"reference",src:t,value:u,context:e,container:this}}resolvePath(t,e,s,r){const i=this.resolvePathWithType(t,e,s,r);return i?i.value:i}setValue(t,e,s,r,i){const n=this.resolvePath(e,s,r,i),u=t.split("."),o=u.slice(0,-1).join(".");this.resolvePath(o,s,r,i)[u[u.length-1]]=n}incValue(t,e,s,r,i){const n=this.resolvePath(e,s,r,i),u=t.split(".");t.startsWith(".")&&u.push("this");const o=u.slice(0,-1).join(".");this.resolvePath(o,s,r,i)[u[u.length-1]]+=n}decValue(t,e,s,r,i){const n=this.resolvePath(e,s,r,i),u=t.split("."),o=u.slice(0,-1).join(".");this.resolvePath(o,s,r,i)[u[u.length-1]]-=n}eqValue(t,e,s,r,i){const n=s,u=this.resolvePath(t,n,r,i),o=this.resolvePath(e,n,r,i);n.floating=u===o}neqValue(t,e,s,r,i){const n=s,u=this.resolvePath(t,n,r,i),o=this.resolvePath(e,n,r,i);n.floating=u!==o}gtValue(t,e,s,r,i){const n=s,u=this.resolvePath(t,n,r,i),o=this.resolvePath(e,n,r,i);n.floating=u>o}geValue(t,e,s,r,i){const n=s,u=this.resolvePath(t,n,r,i),o=this.resolvePath(e,n,r,i);n.floating=u>=o}ltValue(t,e,s,r,i){const n=s,u=this.resolvePath(t,n,r,i),o=this.resolvePath(e,n,r,i);n.floating=u<o}leValue(t,e,s,r,i){const n=s,u=this.resolvePath(t,n,r,i),o=this.resolvePath(e,n,r,i);n.floating=u<=o}deleteValue(t,e,s,r){const i=t.split("."),n=i.slice(0,-1).join(".");delete this.resolvePath(n,e,s,r)[i[i.length-1]]}getValue(t,e,s,r){const i=(t||"floating").split("."),n=i.slice(0,-1).join(".");return this.resolvePath(n,e,s,r)[i[i.length-1]]}async runPipeline(t,e,s,r=0){if(r>10)throw new Error("Pipeline depth is too high: perhaps you are using recursive pipelines?");const i="string"==typeof t?this.getPipeline(t):t;if(!i)throw new Error(`Pipeline not found ${t}`);if(!i.compiler){const t=JSON.stringify(i);this.registerPipeline(t,i,!1);const n=this.getPipeline(t);return n.compiler.execute(n.compiled,e,s,r)}return i.compiler.execute(i.compiled,e,s,r)}use(t,e,s,r=!1){let i;if("function"==typeof t){if(t.name.endsWith("Compiler"))return this.registerCompiler(t),t.name;i=new t({container:this})}else i=t;i.register&&i.register(this);const n=i.settings?i.settings.tag:void 0,u=e||i.name||n||t.name||i.constructor.name;return r&&this.get(u)||this.register(u,i,s),u}getCompiler(t){const e=this.compilers[t];return e||(this.parent?this.parent.getCompiler(t):this.compilers.default)}buildPipeline(t,e=[]){const s=[];if(t&&t.length>0)for(let r=0;r<t.length;r+=1){const i=t[r];if("$super"===i.trim())for(let t=0;t<e.length;t+=1){e[t].trim().startsWith("->")||s.push(e[t])}else s.push(i)}const r=s.length&&s[0].startsWith("// compiler=")?s[0].slice(12):"default",i=this.getCompiler(r),n=i.compile(s);return{pipeline:s,compiler:i,compiled:n}}registerPipeline(t,e,s=!0){if(s||!this.pipelines[t]){this.cache.pipelines={};const s=this.getPipeline(t);this.pipelines[t]=this.buildPipeline(e,s?s.pipeline:[])}}registerPipelineForChilds(t,e,s,r=!0){this.childPipelines||(this.childPipelines={}),this.childPipelines[t]||(this.childPipelines[t]=[]),this.childPipelines[t].push({tag:e,pipeline:s,overwrite:r})}getPipeline(t){if(this.pipelines[t])return this.pipelines[t];if(void 0!==this.cache.pipelines[t])return this.cache.pipelines[t]||void 0;const e=Object.keys(this.pipelines);for(let s=0;s<e.length;s+=1)if(B(t,e[s]))return this.cache.pipelines[t]=this.pipelines[e[s]],this.pipelines[e[s]];this.cache.pipelines[t]=null}registerConfiguration(t,e,s=!0){!s&&this.configurations[t]||(this.configurations[t]=e)}getConfiguration(t){if(this.configurations[t])return this.configurations[t];const e=Object.keys(this.configurations);for(let s=0;s<e.length;s+=1)if(B(t,e[s]))return this.configurations[e[s]]}loadPipelinesFromString(t=""){const e=t.split(/\n|\r|\r\n/);let s="",r=[],i="";for(let t=0;t<e.length;t+=1){const n=e[t];""!==n&&(n.startsWith("# ")?(s&&(i&&!["default","pipelines"].includes(i.toLowerCase())?this.registerPipelineForChilds(i,s,r):this.registerPipeline(s,r)),i=n.slice(1).trim(),s="",r=[]):n.startsWith("## ")?(s&&(i&&!["default","pipelines"].includes(i.toLowerCase())?this.registerPipelineForChilds(i,s,r):this.registerPipeline(s,r)),s=n.slice(2).trim(),r=[]):s&&r.push(n))}s&&(i&&!["default","pipelines"].includes(i.toLowerCase())?this.registerPipelineForChilds(i,s,r):this.registerPipeline(s,r))}async start(t="main"){const e=Object.keys(this.factory);for(let t=0;t<e.length;t+=1){const s=this.factory[e[t]];s.isSingleton&&s.instance&&s.instance.start&&await s.instance.start()}this.getPipeline(t)&&await this.runPipeline(t,{},this)}}const v=new b;var k={Container:b,defaultContainer:v};const{defaultContainer:w}=k;class T{constructor(t=w){this.container=t.container||t,this.name="arrToObj"}static arrToObj(t){const e={};for(let s=0;s<t.length;s+=1)e[t[s]]=1;return e}run(t){return Array.isArray(t)?T.arrToObj(t):(t.tokens=T.arrToObj(t.tokens),t)}}var S=T;const{defaultContainer:P}=k;var $=class{constructor(t=P){this.container=t.container||t,this.name="normalize"}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}run(t){const e=t,s=e.locale||"en",r=this.container.get(`normalizer-${s}`)||this;return e.text=r.normalize(e.text,e),e}};const{defaultContainer:O}=k;var j=class{constructor(t=O,e=!1){this.container=t.container||t,this.name="tokenize",this.shouldNormalize=e}getNormalizer(){return this.normalizer||(this.normalizer=this.container.get(`normalizer-${this.name.slice(-2)}`)||new $),this.normalizer}normalize(t,e){if(void 0===e&&this.shouldNormalize||!0===e){return this.getNormalizer().normalize(t)}return t}innerTokenize(t){return t.split(/[\s,.!?;:([\]'"¡¿)/]+/).filter((t=>t))}tokenize(t,e){let s;if(this.cache){const t=new Date;Math.abs(t.getTime()-this.cache.created)/36e5>1&&(this.cache=void 0)}if(this.cache){if(e?Object.prototype.hasOwnProperty.call(this.cache.normalized,t)&&(s=this.cache.normalized[t]):Object.prototype.hasOwnProperty.call(this.cache.nonNormalized,t)&&(s=this.cache.nonNormalized[t]),s)return s}else this.cache={created:(new Date).getTime(),normalized:{},nonNormalized:{}};return s=this.innerTokenize(this.normalize(t,e),e),e?this.cache.normalized[t]=s:this.cache.nonNormalized[t]=s,s}async run(t){const e=t,s=e.locale||"en";let r=this.container.get(`tokenizer-${s}`);if(!r){const t=this.container.get("tokenizer-bert");r=t&&t.activeFor(s)?t:this}const i=await r.tokenize(e.text,e);return e.tokens=i.filter((t=>t)),e}};const{defaultContainer:R}=k;var L=class{constructor(t=R,e){this.container=t.container||t,this.cache={},this.setCurrent(""),this.dictionary=e||{before:{},after:{}}}setCurrent(t){this.current=t,this.cursor=0,this.limit=this.current.length,this.limit_backward=0,this.bra=this.cursor,this.ket=this.limit}getCurrent(){return this.current}bc(t,e){return 0==(t[e>>>3]&1<<(7&e))}in_grouping(t,e,s){if(this.cursor>=this.limit)return!1;let r=this.current.charCodeAt(this.cursor);return!(r>s||r<e)&&(r-=e,!this.bc(t,r)&&(this.cursor++,!0))}in_grouping_b(t,e,s){if(this.cursor<=this.limit_backward)return!1;let r=this.current.charCodeAt(this.cursor-1);return!(r>s||r<e)&&(r-=e,!this.bc(t,r)&&(this.cursor--,!0))}out_grouping(t,e,s){if(this.cursor>=this.limit)return!1;let r=this.current.charCodeAt(this.cursor);return r>s||r<e?(this.cursor++,!0):(r-=e,!!this.bc(t,r)&&(this.cursor++,!0))}out_grouping_b(t,e,s){if(this.cursor<=this.limit_backward)return!1;let r=this.current.charCodeAt(this.cursor-1);return r>s||r<e?(this.cursor--,!0):(r-=e,!!this.bc(t,r)&&(this.cursor--,!0))}eq_s(t,e){return"string"==typeof t&&(t=(e=t).length),!(this.limit-this.cursor<t||this.current.slice(this.cursor,this.cursor+t)!=e)&&(this.cursor+=t,!0)}eq_s_b(t,e){return"string"==typeof t&&(t=(e=t).length),!(this.cursor-this.limit_backward<t||this.current.slice(this.cursor-t,this.cursor)!=e)&&(this.cursor-=t,!0)}find_among(t,e){let s=0,r=e||t.length;const i=this.cursor,n=this.limit;let u=0,o=0,a=!1;for(;;){const e=s+(r-s>>>1);let h=0,g=u<o?u:o;var c,l=t[e];for(c=g;c<l.s_size;c++){if(i+g==n){h=-1;break}if(h=this.current.charCodeAt(i+g)-l.s.charCodeAt(c),0!=h)break;g++}if(h<0?(r=e,o=g):(s=e,u=g),r-s<=1){if(s>0)break;if(r==s)break;if(a)break;a=!0}}for(;;){if(u>=(l=t[s]).s_size){if(this.cursor=i+l.s_size,null==l.method)return l.result;const t=l.method(l.instance);if(this.cursor=i+l.s_size,t)return l.result}if(s=l.substring_i,s<0)return 0}return-1}find_among_b(t,e){let s=0,r=e||t.length;const i=this.cursor,n=this.limit_backward;let u=0,o=0,a=!1;for(;;){const e=s+(r-s>>1);let h=0,g=u<o?u:o;var c;for(c=(l=t[e]).s_size-1-g;c>=0;c--){if(i-g==n){h=-1;break}if(h=this.current.charCodeAt(i-1-g)-l.s.charCodeAt(c),0!=h)break;g++}if(h<0?(r=e,o=g):(s=e,u=g),r-s<=1){if(s>0)break;if(r==s)break;if(a)break;a=!0}}for(;;){var l;if(u>=(l=t[s]).s_size){if(this.cursor=i-l.s_size,null==l.method)return l.result;const t=l.method(this);if(this.cursor=i-l.s_size,t)return l.result}if(s=l.substring_i,s<0)return 0}return-1}replace_s(t,e,s){const r=s.length-(e-t);return this.current=this.current.slice(0,t)+s+this.current.slice(e),this.limit+=r,this.cursor>=e?this.cursor+=r:this.cursor>t&&(this.cursor=t),r}slice_check(){return!(this.bra<0||this.bra>this.ket||this.ket>this.limit||this.limit>this.current.length)}slice_from(t){return!!this.slice_check()&&(this.replace_s(this.bra,this.ket,t),!0)}slice_del(){return this.slice_from("")}insert(t,e,s){const r=this.replace_s(t,e,s);t<=this.bra&&(this.bra+=r),t<=this.ket&&(this.ket+=r)}slice_to(t){let e="";return this.slice_check()&&(e=this.current.slice(this.bra,this.ket)),e}stemWord(t){let e=this.cache[`.${t}`];return null==e&&(this.dictionary.before.hasOwnProperty(t)?e=this.dictionary.before[t]:(this.setCurrent(t),this.innerStem(),e=this.getCurrent(),this.dictionary.after.hasOwnProperty(e)&&(e=this.dictionary.after[e])),this.cache[`.${t}`]=e),e}stemWords(t){const e=[];for(let s=0;s<t.length;s++){const r=this.stemWord(t[s]);r&&e.push(r.trim())}return e}stem(t){return null==t?t:Array.isArray(t)?this.stemWords(t):this.stemWords([t])[0]}getTokenizer(){return this.tokenizer||(this.tokenizer=this.container.get(`tokenizer-${this.name.slice(-2)}`)||new j),this.tokenizer}getStopwords(){return this.stopwords||(this.stopwords=this.container.get(`tokenizer-${this.name.slice(-2)}`)),this.stopwords}tokenizeAndStem(t,e=!0){let s=this.getTokenizer().tokenize(t,!0);if(!e){const t=this.getStopwords();t&&(s=t.removeStopwords(s))}return this.stemWords(s)}};const{defaultContainer:z}=k;class _{constructor(t=z){this.container=t.container||t,this.name="objToArr"}static objToArr(t){return Object.keys(t)}run(t){return t.tokens?(t.tokens=_.objToArr(t.tokens),t):_.objToArr(t)}}var N=_;const{defaultContainer:W}=k;var V=class{constructor(t=W){this.container=t.container||t,this.name="stem"}stem(t){return t}getStemmer(t){const e=t,s=e.locale||e.settings&&e.settings.locale||"en";let r=this.container.get(`stemmer-${s}`);if(!r){const t=this.container.get("stemmer-bert");r=t&&t.activeFor(s)?t:this}return r}async addForTraining(t){const e=this.getStemmer(t);return e.addUtterance&&await e.addUtterance(t.utterance,t.intent),t}async train(t){const e=this.getStemmer(t);return e.innerTrain&&await e.innerTrain(),t}async run(t){const e=t,s=this.getStemmer(e);return e.tokens=await s.stem(e.tokens,e),e}};const{defaultContainer:M}=k;var q=class{constructor(t=M){this.container=t.container||t,this.name="removeStopwords",this.dictionary={}}build(t){for(let e=0;e<t.length;e+=1)this.dictionary[t[e]]=!0}isNotStopword(t){return!this.dictionary[t]}isStopword(t){return!!this.dictionary[t]}removeStopwords(t){return t.filter((t=>this.isNotStopword(t)))}run(t){if(t.settings&&!1===t.settings.keepStopwords){const e=t,s=e.locale||"en",r=this.container.get(`stopwords-${s}`)||this;return e.tokens=r.removeStopwords(e.tokens,e).filter((t=>t)),e}return t}};const{defaultContainer:J}=k;var I=class{constructor(t=J){this.container=t.container||t,this.name="timer"}start(t){return t&&(t.hrstart=new Date),t}stop(t){const e=t;if(e&&e.hrstart){const t=new Date;e.elapsed=t.getTime()-e.hrstart.getTime(),delete e.hrstart}return e}run(t){this.start(t)}};const{defaultContainer:K}=k;var U=class{constructor(t={},e=K){this.container=t.container||e,this.applySettings(this,t)}get logger(){return this.container.get("logger")}applySettings(t,e={}){const s=t||{};return Object.keys(e).forEach((t=>{void 0===s[t]&&(s[t]=e[t])})),s}toJSON(){const t=this.jsonExport||{},e={},s=Object.keys(this);for(let r=0;r<s.length;r+=1){const i=s[r];if("jsonExport"!==i&&"jsonImport"!==i&&"container"!==i&&!i.startsWith("pipeline")){const s=void 0===t[i]||t[i];if("function"==typeof s){const t=s.bind(this)(e,this,i,this[i]);t&&(e[i]=t)}else"boolean"==typeof s?s&&(e[i]=this[i],"settings"===i&&delete e[i].container):"string"==typeof s&&(e[s]=this[i])}}return e}fromJSON(t){const e=this.jsonImport||{},s=Object.keys(t);for(let r=0;r<s.length;r+=1){const i=s[r],n=void 0===e[i]||e[i];if("function"==typeof n){const e=n.bind(this)(this,t,i,t[i]);e&&(this[i]=e)}else"boolean"==typeof n?n&&(this[i]=t[i]):"string"==typeof n&&(this[n]=t[i])}}objToValues(t,e){const s=e||Object.keys(t),r=[];for(let e=0;e<s.length;e+=1)r.push(t[s[e]]);return r}valuesToObj(t,e){const s={};for(let r=0;r<t.length;r+=1)s[e[r]]=t[r];return s}getPipeline(t){return this.container.getPipeline(t)}async runPipeline(t,e){return this.container.runPipeline(e||this.pipeline,t,this)}use(t){this.container.use(t)}};const{defaultContainer:G}=k;var H=class extends U{constructor(t={},e=void 0){super({settings:{},container:t.container||e||G},e),this.applySettings(this.settings,t),this.applySettings(this.settings,{etag:1,memory:{}}),this.settings.tag||(this.settings.tag="storage"),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag))}read(t){return new Promise((e=>{const s={};Array.isArray(t)||(t=[t]),t.forEach((t=>{const e=this.settings.memory[t];e&&(s[t]=JSON.parse(e))})),e(s)}))}saveItem(t,e){const s={...e};return s.eTag=this.settings.etag.toString(),this.settings.etag+=1,this.settings.memory[t]=JSON.stringify(s),s}write(t){return new Promise(((e,s)=>{Object.keys(t).forEach((r=>{const i=t[r],n=this.settings.memory[r];if(!n||"*"===i.eTag)return e(this.saveItem(r,i));const u=JSON.parse(n);return i.eTag!==u.eTag?s(new Error(`Error writing "${r}" due to eTag conflict.`)):e(this.saveItem(r,i))}))}))}delete(t){return new Promise((e=>{t.forEach((t=>delete this.settings.memory[t])),e()}))}};var Z={readFile:function(){return new Promise((t=>{t(void 0)}))},writeFile:function(){return new Promise(((t,e)=>{e(new Error("File cannot be written in web"))}))},existsSync:function(){return!1},lstatSync:function(){},readFileSync:function(){},name:"fs"};const{Container:Q}=k,{loadEnvFromJson:X}=C;function Y(t,e){if("string"==typeof t)return t.startsWith("$")?process.env[`${e}${t.slice(1)}`]||process.env[t.slice(1)]:t;if(Array.isArray(t))return t.map((t=>Y(t,e)));if("object"==typeof t){const s=Object.keys(t),r={};for(let i=0;i<s.length;i+=1)r[s[i]]=Y(t[s[i]],e);return r}return t}var tt=function(t,e,s,r,i,n){const u=t||{},o=s||new Q(r);o.parent=n,r||(o.register("fs",Z),o.use(S),o.use($),o.use(N),o.use(V),o.use(q),o.use(j),o.use(I),o.use(x),o.use(H));const a=u;let c;if(u.env&&X(r,u.env),c=a,c=Y(c,r?`${r}_`:""),c.settings){const t=Object.keys(c.settings);for(let e=0;e<t.length;e+=1)o.registerConfiguration(t[e],c.settings[t[e]],!0)}if(c.use)for(let t=0;t<c.use.length;t+=1){const e=c.use[t];Array.isArray(e)?o.register(e[0],e[1]):o.use(e)}if(c.terraform)for(let t=0;t<c.terraform.length;t+=1){const e=c.terraform[t],s=o.get(e.className);o.register(e.name,s,!0)}if(c.childs&&(o.childs=c.childs),i)for(let t=0;t<i.length;t+=1){const e=i[t];o.registerPipeline(e.tag,e.pipeline,e.overwrite)}return c.pipelines&&function(t,e){t.loadPipelinesFromString(e)}(o,c.pipelines),o};var et=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return`${t()+t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`};const st=new class{constructor(){this.containers={}}getContainer(t){return this.containers[t||"default"]}async createContainer(t,e,s,r,i,n){const u=void 0===s||s;if("string"!=typeof t&&(e=t,t=""),e||"default"!==t&&""!==t||(e="conf.json"),!this.containers[t]){const s=tt(e,u,void 0,r,n);s.name=t,this.containers[t]=s,s.dock=this,s.parent=i,await s.start(),s.childs&&await this.buildChilds(s)}return this.containers[t]}async buildChilds(t){if(t&&t.childs){const e=Object.keys(t.childs),s={};for(let r=0;r<e.length;r+=1){const i=t.childs[e[r]];i.isChild=!0,i.pathPipeline||(i.pathPipeline=`${e[r]}_pipeline.md`),s[e[r]]=await this.createContainer(e[r],i,!1,e[r],t,t.childPipelines?t.childPipelines[e[r]]:void 0)}t.childs=s}}async terraform(t,e=!0){return await this.createContainer("default",t,e,"")}start(t,e=!0){return this.terraform(t,e)}};var rt=st;const{defaultContainer:it}=k;var nt=class extends U{constructor(t={},e=void 0){super({settings:{},container:t.container||e||it},e),this.applySettings(this.settings,t),this.settings.tag||(this.settings.tag="context"),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag))}getStorage(){const t=this.container.get(this.settings.storageName||"storage");if(!t)throw new Error("Storage not found");return t}getContext(t){return this.getStorage().read(`${this.settings.tag}-${t}`)}setContext(t,e){const s={[t]:e};return this.getStorage().write(s)}async getContextValue(t,e){const s=await this.getContext(t);return s?s[e]:void 0}async setContextValue(t,e,s){let r=await this.getContext(t);return r||(r={}),r[e]=s,this.setContext(t,r)}};const{Container:ut,defaultContainer:ot}=k,{hasUnicode:at,unicodeToArray:ct,asciiToArray:lt,stringToArray:ht,compareWildcars:gt,loadEnv:ft}=C;var dt={Among:e,ArrToObj:S,BaseStemmer:L,containerBootstrap:tt,Clonable:U,Container:ut,defaultContainer:ot,hasUnicode:at,unicodeToArray:ct,asciiToArray:lt,stringToArray:ht,compareWildcars:gt,loadEnv:ft,Normalizer:$,ObjToArr:N,Stemmer:V,Stopwords:q,Tokenizer:j,Timer:I,logger:x,MemoryStorage:H,uuid:et,dock:rt,Context:nt,dockStart:async function(t,e){return await rt.start(t,e),rt}},pt=Object.freeze({__proto__:null,default:[["ar","arb","Arabic"],["bn","ben","Bengali"],["ca","cat","Catalan"],["cs","ces","Czech"],["da","dan","Danish"],["de","deu","German"],["el","ell","Greek"],["en","eng","English"],["eu","eus","Basque"],["fa","fas","Persian"],["fi","fin","Finnish"],["fr","fra","French"],["ga","gle","Irish"],["gl","glg","Galician"],["hi","hin","Hindi"],["hu","hun","Hungarian"],["hy","hye","Armenian"],["id","ind","Indonesian"],["it","ita","Italian"],["ja","jpn","Japanese"],["ko","kor","Korean"],["lt","lit","Lithuanian"],["ne","nep","Nepali"],["nl","nld","Dutch"],["no","nor","Norwegian"],["pl","pol","Polish"],["pt","por","Portuguese"],["ro","ron","Romanian"],["ru","rus","Russian"],["sr","srp","Serbian"],["sl","slv","Slovenian"],["es","spa","Spanish"],["sv","swe","Swedish"],["ta","tam","Tamil"],["tl","tgl","Tagalog"],["th","tha","Thai"],["tr","tur","Turkish"],["uk","ukr","Ukrainian"],["zh","cmn","Chinese"]]}),mt={spa:"",eng:"",por:"",ind:"",fra:"",deu:"",ita:"",tur:"",nld:"",tgl:"",hun:"",ces:"",swe:"",fin:"",dan:"",cat:"",glg:"",slv:""},Dt={rus:"",ukr:""},yt={arb:"",fas:""},Ft={hin:""},At={},Ct={},Et={Latin:mt,Cyrillic:Dt,Arabic:yt,Devanagari:Ft,Ethiopic:At,Hebrew:Ct},xt=Object.freeze({__proto__:null,Latin:mt,Cyrillic:Dt,Arabic:yt,Devanagari:Ft,Ethiopic:At,Hebrew:Ct,default:Et});function Bt(t){return t&&t.default||t}var bt=Bt(pt),vt=Bt(xt);const kt={cmn:/[\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u3005\u3007\u3021-\u3029\u3038-\u303B\u3400-\u4DB5\u4E00-\u9FCC\uF900-\uFA6D\uFA70-\uFAD9]|[\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/g,Latin:/[A-Za-z\xAA\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02B8\u02E0-\u02E4\u1D00-\u1D25\u1D2C-\u1D5C\u1D62-\u1D65\u1D6B-\u1D77\u1D79-\u1DBE\u1E00-\u1EFF\u2071\u207F\u2090-\u209C\u212A\u212B\u2132\u214E\u2160-\u2188\u2C60-\u2C7F\uA722-\uA787\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA7FF\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uFB00-\uFB06\uFF21-\uFF3A\uFF41-\uFF5A]/g,Cyrillic:/[\u0400-\u0484\u0487-\u052F\u1D2B\u1D78\u2DE0-\u2DFF\uA640-\uA69D\uA69F]/g,Arabic:/[\u0600-\u0604\u0606-\u060B\u060D-\u061A\u061E\u0620-\u063F\u0641-\u064A\u0656-\u065F\u066A-\u066F\u0671-\u06DC\u06DE-\u06FF\u0750-\u077F\u08A0-\u08B2\u08E4-\u08FF\uFB50-\uFBC1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFD\uFE70-\uFE74\uFE76-\uFEFC]|\uD803[\uDE60-\uDE7E]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB\uDEF0\uDEF1]/g,ben:/[\u0980-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09FB]/g,Devanagari:/[\u0900-\u0950\u0953-\u0963\u0966-\u097F\uA8E0-\uA8FB]/g,jpn:/[\u3041-\u3096\u309D-\u309F]|\uD82C\uDC01|\uD83C\uDE00|[\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u32D0-\u32FE\u3300-\u3357\uFF66-\uFF6F\uFF71-\uFF9D]|\uD82C\uDC00/g,kor:/[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/g,tel:/[\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C78-\u0C7F]/g,tam:/[\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BFA]/g,guj:/[\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AF1]/g,kan:/[\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2]/g,mal:/[\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D75\u0D79-\u0D7F]/g,Myanmar:/[\u1000-\u109F\uA9E0-\uA9FE\uAA60-\uAA7F]/g,ori:/[\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B77]/g,pan:/[\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75]/g,Ethiopic:/[\u1200-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u137C\u1380-\u1399\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E]/g,tha:/[\u0E01-\u0E3A\u0E40-\u0E5B]/g,sin:/[\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2-\u0DF4]|\uD804[\uDDE1-\uDDF4]/g,ell:/[\u0370-\u0373\u0375-\u0377\u037A-\u037D\u037F\u0384\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03E1\u03F0-\u03FF\u1D26-\u1D2A\u1D5D-\u1D61\u1D66-\u1D6A\u1DBF\u1F00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2126\uAB65]|\uD800[\uDD40-\uDD8C\uDDA0]|\uD834[\uDE00-\uDE45]/g,khm:/[\u1780-\u17DD\u17E0-\u17E9\u17F0-\u17F9\u19E0-\u19FF]/g,hye:/[\u0531-\u0556\u0559-\u055F\u0561-\u0587\u058A\u058D-\u058F\uFB13-\uFB17]/g,sat:/[\u1C50-\u1C7F]/g,bod:/[\u0F00-\u0F47\u0F49-\u0F6C\u0F71-\u0F97\u0F99-\u0FBC\u0FBE-\u0FCC\u0FCE-\u0FD4\u0FD9\u0FDA]/g,Hebrew:/[\u0591-\u05C7\u05D0-\u05EA\u05F0-\u05F4\uFB1D-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFB4F]/g,kat:/[\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u10FF\u2D00-\u2D25\u2D27\u2D2D]/g,lao:/[\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF]/g,zgh:/[\u2D30-\u2D67\u2D6F\u2D70\u2D7F]/g,iii:/[\uA000-\uA48C\uA490-\uA4C6]/g,aii:/[\u0700-\u070D\u070F-\u074A\u074D-\u074F]/g},wt=Object.keys(kt);class Tt{constructor(){this.languagesAlpha3={},this.languagesAlpha2={},this.extraSentences=[],this.buildData()}static getTrigrams(t){const e=[],s=t?` ${String(t).replace(/[\u0021-\u0040]+/g," ").replace(/\s+/g," ").trim().toLowerCase()} `:"";if(!s||s.length<3)return e;for(let t=0,r=s.length-2;t<r;t+=1)e[t]=s.substr(t,3);return e}static asTuples(t){const e=Tt.getTrigrams(t).reduce(((t,e)=>{const s=t;return s[e]=(s[e]||0)+1,s}),{}),s=[];return Object.keys(e).forEach((t=>{s.push([t,e[t]])})),s.sort(((t,e)=>t[1]-e[1])),s}static getDistance(t,e){let s=0;return t.forEach((t=>{s+=t[0]in e?Math.abs(t[1]-e[t[0]]-1):300})),s}static getOccurrence(t,e){const s=t.match(e);return(s?s.length:0)/t.length||0}static isLatin(t){let e=0;const s=t.length/2;for(let r=0;r<t.length;r+=1){const i=t.charCodeAt(r);if(i>=32&&i<=126&&(e+=1,e>s))return!0}return e>s}static getTopScript(t){if(Tt.isLatin(t))return["Latin",1];let e,s=-1;for(let r=0;r<wt.length;r+=1){const i=wt[r],n=Tt.getOccurrence(t,kt[i]);if(n>s&&(s=n,e=i,1===s))return[e,s]}return[e,s]}static filterLanguages(t,e,s){if(0===e.length&&0===s.length)return t;const r={};return Object.keys(t).forEach((i=>{(0===e.length||e.indexOf(i)>-1)&&-1===s.indexOf(i)&&(r[i]=t[i])})),r}static getDistances(t,e,s){const r=[],i=s.allowList||[],n=s.denyList||[],u=Tt.filterLanguages(e,i,n);return u?(Object.keys(u).forEach((e=>{r.push([e,Tt.getDistance(t,u[e])])})),r.sort(((t,e)=>t[1]-e[1]))):[["und",1]]}static detectAll(t,e={}){const s=e.minLength||10;if(!t||t.length<s)return[["und",1]];const r=t.substr(0,2048),i=Tt.getTopScript(r);if(!(i[0]in vt)&&i[1]>.5){if(!e.allowList)return[[i[0],1]];if(e.allowList.includes(i[0]))return[[i[0],1]];if("cmn"===i[0]&&e.allowList.includes("jpn"))return[["jpn",1]]}if(vt[i[0]]){const t=Tt.getDistances(Tt.asTuples(r),vt[i[0]],e);if("und"===t[0][0])return[[i[0],1]];const s=t[0][1],n=300*r.length-s;return t.map((t=>[t[0],1-(t[1]-s)/n||0]))}return[[i[0],1]]}buildData(){for(let t=0;t<bt.length;t+=1){const e={alpha2:bt[t][0],alpha3:bt[t][1],name:bt[t][2]};this.languagesAlpha3[e.alpha3]=e,this.languagesAlpha2[e.alpha2]=e}}transformAllowList(t){const e=[];for(let s=0;s<t.length;s+=1)if(3===t[s].length)e.push(t[s]);else{const r=this.languagesAlpha2[t[s]];r&&e.push(r.alpha3)}return e}guess(t,e,s){const r={};t.length<10&&(r.minLength=t.length),e&&e.length&&e.length>0&&(r.allowList=this.transformAllowList(e));const i=Tt.detectAll(t,r),n=[];for(let t=0;t<i.length;t+=1){const e=this.languagesAlpha3[i[t][0]];if(e&&(n.push({alpha3:e.alpha3,alpha2:e.alpha2,language:e.name,score:i[t][1]}),s&&n.length>=s))break}return n}guessBest(t,e){return this.guess(t,e,1)[0]}addTrigrams(t,e){const s=this.languagesAlpha2[t],r=s?s.alpha3:t,i=Tt.getTopScript(e)[0],n=Tt.getTrigrams(e);vt[i]&&(vt[i][r]||(vt[i][r]={}),n.forEach((t=>{vt[i][r][t]=1})))}addExtraSentence(t,e){this.extraSentences.push([t,e]),this.addTrigrams(t,e)}processExtraSentences(){this.extraSentences.forEach((t=>{this.addTrigrams(t[0],t[1])}))}static lansplit(t){if(t.includes("|"))return t.split("|");const e=[];for(let s=0;s<t.length;s+=3)e.push(t.substr(s,3));return e}static addModel(t,e,s){const r=vt[t],i=Tt.lansplit(s);let n=i.length;const u={};for(;n>0;)n-=1,u[i[n]]=n;r[e]=u}addModel(t,e,s){Tt.addModel(t,e,s)}static buildModel(){Object.keys(vt).forEach((t=>{const e=vt[t];Object.keys(e).forEach((s=>{Tt.addModel(t,s,e[s])}))}))}}Tt.buildModel();var St={Language:Tt};const Pt=[],$t=[];var Ot=function(t,e){t.length>e.length&&([t,e]=[e,t]);let s=t.length-1,r=e.length-1;for(;s>0&&t.charCodeAt(s)===e.charCodeAt(r);)s-=1,r-=1;s+=1,r+=1;let i,n,u,o,a=0;for(;a<s&&t.charCodeAt(a)===e.charCodeAt(a);)a+=1;if(s-=a,r-=a,0===s)return r;for(let e=0;e<s;e+=1)$t[e]=t.charCodeAt(a+e),Pt[e]=e+1;let c=0;for(;c<r;){i=e.charCodeAt(a+c),u=c,c+=1,n=c;for(let t=0;t<s;t+=1)o=u+(i!==$t[t])|0,u=Pt[t],Pt[t]=u>n?o>n?n+1:o:o>u?u+1:o,n=Pt[t]}return n};var jt=function(t,e,s=!1){return s&&(t=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()),t===e?0:Ot(t,e)};var Rt=class{constructor(t){this.container=t}getTokens(t,e="en"){if("string"==typeof t){const s=this.container&&this.container.get(`tokenizer-${e}`);return s?s.tokenize(t,!0):t.split(" ")}return t}termFreqMap(t,e){const s=this.getTokens(t,e),r={};return s.forEach((t=>{r[t]=(r[t]||0)+1})),r}addKeysToDict(t,e){Object.keys(t).forEach((t=>{e[t]=!0}))}termFreqMapToVector(t,e){const s=[];return Object.keys(e).forEach((e=>{s.push(t[e]||0)})),s}vecDotProduct(t,e){let s=0;for(let r=0;r<t.length;r+=1)s+=t[r]*e[r];return s}vecMagnitude(t){let e=0;for(let s=0;s<t.length;s+=1)e+=t[s]*t[s];return Math.sqrt(e)}cosineSimilarity(t,e){return this.vecDotProduct(t,e)/(this.vecMagnitude(t)*this.vecMagnitude(e))}getTermFreqVectors(t,e,s){const r=this.termFreqMap(t,s),i=this.termFreqMap(e,s);if(!Object.keys(r).length||!Object.keys(i).length)return 0;const n={};return this.addKeysToDict(r,n),this.addKeysToDict(i,n),[this.termFreqMapToVector(r,n),this.termFreqMapToVector(i,n)]}similarity(t,e,s){if(t===e)return 1;const[r,i]=this.getTermFreqVectors(t,e,s);return this.cosineSimilarity(r,i)}};var Lt=class{constructor(t){this.settings=t||{},this.minLength=this.settings.minLength||4,this.settings.features?this.setFeatures(this.settings.features):(this.features={},this.featuresByLength={})}setFeatures(t){this.features=t,this.featuresByLength={},this.featuresList=Object.keys(this.features);for(let t=0;t<this.featuresList.length;t+=1){const e=this.featuresList[t],{length:s}=e;this.featuresByLength[s]||(this.featuresByLength[s]=[]),this.featuresByLength[s].push(e)}}checkToken(t,e){if(this.features[t])return t;if(t.length<this.minLength)return t;let s,r=1/0;for(let i=t.length-e-1;i<t.length+e;i+=1){const n=this.featuresByLength[i+1];if(n)for(let i=0;i<n.length;i+=1){const u=n[i],o=jt(t,u);if(o<=e)if(o<r)s=u,r=o;else if(o===r&&s){const e=Math.abs(s.length-t.length),i=Math.abs(u.length-t.length);(e>i||e===i&&this.features[u]>this.features[s])&&(s=u,r=o)}}}return s||t}check(t,e=1){if(!Array.isArray(t)){const s=Object.keys(t),r=this.check(s,e),i={};for(let e=0;e<r.length;e+=1)i[r[e]]=t[s[e]];return i}const s=[];for(let r=0;r<t.length;r+=1)s.push(this.checkToken(t[r],e));return s}},zt={leven:Ot,CosineSimilarity:Rt,similarity:jt,SpellCheck:Lt};const _t={Between:"between",After:"after",AfterLast:"afterLast",AfterFirst:"afterFirst",Before:"before",BeforeFirst:"beforeFirst",BeforeLast:"beforeLast"};var Nt={TrimType:_t,TrimTypesList:Object.values(_t)};const{TrimTypesList:Wt}=Nt;function Vt(t,e,s,r=[]){let i,n;if(t.accuracy>e.accuracy||t.accuracy===e.accuracy&&t.length>e.length?(i=t,n=e):(i=e,n=t),n.start<=i.end&&n.end>=i.start)if(n.accuracy<i.accuracy)n.discarded=!0;else if((s||n.entity===i.entity||"number"===n.entity)&&n.len<=i.len)n.start===i.start&&n.end===i.end&&n.type===i.type&&n.entity===i.entity&&n.option===i.option?n.discarded=!0:n.start===i.start&&n.end===i.end&&n.entity===i.entity&&n.type!==i.type&&("trim"===i.type&&"trim"!==n.type?i.discarded=!0:("trim"!==i.type&&n.type,n.discarded=!0));else if((s||n.entity===i.entity||"number"===i.entity)&&n.len>i.len)i.discarded=!0;else if("enum"===i.type&&"enum"===n.type){const t=r.includes(i.entity),e=r.includes(n.entity);t&&!e?n.discarded=!0:!t&&e||i.len<=n.len&&n.utteranceText.includes(i.utteranceText)?i.discarded=!0:i.len>n.len&&i.utteranceText.includes(n.utteranceText)&&(n.discarded=!0)}}var Mt=function(t,e=!0,s=[]){const r=(t=function(t){for(let e=0,s=t.length;e<s;e+=1){const s=t[e];if("trim"===s.type&&Wt.includes(s.subtype))for(let r=0;r<t.length;r+=1){const i=t[r];if(e!==r&&i.start>=s.start&&i.end<=s.end&&"trim"!==i.type){const t=s.end-s.start,e=i.end-i.start;if(s.end===i.end){const r=s.sourceText.substring(0,t-e-1);s.sourceText=r,s.utteranceText=r,s.end=i.start-1,s.len=r.length}else if(s.start===i.start){const t=s.sourceText.substring(e+1);s.sourceText=t,s.utteranceText=t,s.start=i.end+1,s.len=t.length}}}}return t}(t)).length;for(let i=0;i<r;i+=1){const n=t[i];if(0===n.len&&(n.discarded=!0),!n.discarded)for(let u=i+1;u<r;u+=1){const r=t[u];if(r.discarded||Vt(n,r,e,s),n.discarded)break}if(!n.discarded){const t=s.indexOf(n.entity);-1!==t&&s.splice(t,1)}}return t.filter((t=>!t.discarded))};const{defaultContainer:qt}=dt,{Language:Jt}=St,{similarity:It}=zt;var Kt=class{constructor(t=qt){this.container=t.container||t,this.name="extract-enum"}getScripts(t){const e=[],s=t.split("");for(let t=0;t<s.length;t+=1)e.push(Jt.getTopScript(s[t]));return e}isAlphanumeric(t){return/[\u00C0-\u1FFF\u2C00-\uD7FF\w]/.test(t)&&"_"!==t}getWordPositions(t){const e=this.getScripts(t);let s=!0,r=0,i=0;const n=t.length,u=[];for(;i<n;)this.isAlphanumeric(t.charAt(i))?s&&("cmn"===e[i][0]?(u.push({start:i,end:i,len:1}),r=i):(r=i,s=!1)):s||(u.push({start:r,end:i-1,len:i-r}),s=!0),i+=1;return s||u.push({start:r,end:i-1,len:i-r}),u}getBestSubstring(t,e,s){const r=t.length,i=e.length;if(r<=i){const s={start:0,end:r-1,len:r,levenshtein:It(t,e,!0)};return s.accuracy=(i-s.levenshtein)/i,s}const n=s||this.getWordPositions(t),u=n.length,o={start:0,end:0,len:0,levenshtein:void 0,accuracy:0};for(let s=0;s<u;s+=1)for(let r=s;r<u;r+=1){const i=t.substring(n[s].start,n[r].end+1),u=It(i,e,!0);(void 0===o.levenshtein||u<o.levenshtein)&&(o.levenshtein=u,o.start=n[s].start,o.end=n[r].end,o.len=o.end-o.start+1)}return o.accuracy=(i-o.levenshtein)/i,o}getBestSubstringList(t,e,s,r=1){const i=t.length,n=e.length,u=[];if(i<=n){const s=It(t,e,!0),o=(n-s)/n;return o>=r&&u.push({start:0,end:i-1,len:i,levenshtein:s,accuracy:o}),u}const o=n*(1-r),a=s||this.getWordPositions(t),c=a.length;for(let s=0;s<c;s+=1)for(let i=s;i<c;i+=1){const c=t.substring(a[s].start,a[i].end+1),l=It(c,e,!0),h=(n-l)/n;if(h>=r&&u.push({start:a[s].start,end:a[i].end,len:a[i].end-a[s].start+1,levenshtein:l,accuracy:h}),c.length-a[0].len>=e.length+o)break}return u}getRules(t){const e=t.nerRules;return e||[]}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}buildRuleDict(t){const e={},s={};for(let r=0;r<t.rules.length;r+=1){const i=t.rules[r];for(let t=0;t<i.texts.length;t+=1){const r=i.texts[t],n=this.normalize(i.texts[t]);e[n]||(e[n]=[]),e[n].push(i),s[n]=r}}t.dict=e,t.inverseDict=s}getBestExact(t,e,s){const r=this.normalize(t),i=e||this.getWordPositions(r),n=i.length,u=[];for(let e=0;e<n;e+=1)for(let o=e;o<n;o+=1){const n=r.substring(i[e].start,i[o].end+1);if(s.dict[n]){const r=s.dict[n];for(let a=0;a<r.length;a+=1)u.push({accuracy:1,start:i[e].start,end:i[o].end,len:i[o].end-i[e].start+1,levenshtein:0,entity:s.name,type:s.type,option:r[a].option,sourceText:s.inverseDict[n],utteranceText:t.substring(i[e].start,i[o].end+1)})}}return u}extractFromRule(t,e,s,r){if("enum"===e.type){const i=[];if(r>=1){e.dict||this.buildRuleDict(e);const r=this.getBestExact(t,s,e);for(let t=0;t<r.length;t+=1)i.push(r[t])}else for(let n=0;n<e.rules.length;n+=1){const u=e.rules[n];if(u&&u.option&&Array.isArray(u.texts))for(let o=0;o<u.texts.length;o+=1){const a=this.getBestSubstringList(t,u.texts[o],s,u.threshold||r);for(let s=0;s<a.length;s+=1)i.push({...a[s],entity:e.name,type:e.type,option:e.rules[n].option,sourceText:u.texts[o],utteranceText:t.substring(a[s].start,a[s].end+1)})}}return i}return[]}async extract(t){const e=t,s=e.text||e.utterance;let r=s;const i=[],n=this.container.get("tokenize");if(n){const t=await n.run({locale:e.locale,text:r});if(r=t.tokens.join(" "),r!==s){let e=0,r=0;for(let n=0;n<t.tokens.length;n+=1){const u=s.indexOf(t.tokens[n],e);for(let e=0;e<t.tokens[n].length;e+=1)i[r+e]=u+e;e+=t.tokens[n].length,r+=t.tokens[n].length+1}}}const u=this.getWordPositions(r),o=this.getRules(e),a=e.edges||[];for(let t=0;t<o.length;t+=1){const s=this.extractFromRule(r,o[t],u,e.threshold||.8);for(let t=0;t<s.length;t+=1)a.push(s[t])}if(i.length>0)for(let t=0;t<a.length;t+=1){const e=a[t];e.start=i[e.start],e.end=i[e.end]}return a.sort(((t,e)=>t.start-e.start)),e.edges=Mt(a,!1,e.intentEntities),e}run(t){const e=t,s=e.locale||"en";return(this.container.get(`extract-enum-${s}`)||this).extract(e)}};const{defaultContainer:Ut}=dt;var Gt=class{constructor(t=Ut){this.container=t.container||t,this.name="extract-regex"}getRules(t){const e=t.nerRules;return e||[]}getMatchs(t,e){const s=[];let r;do{const i=e instanceof RegExp?e.exec(t):null;if(i){if(1===i.length)s.push({start:i.index,end:e.lastIndex-1,accuracy:1,sourceText:i[0]});else{const e=t.indexOf(i[1]);s.push({start:e,end:e+i[1].length-1,accuracy:1,sourceText:i[1]})}r=!0}else r=!1}while(r);return s}extractFromRule(t,e){const s=[];for(let r=0;r<e.rules.length;r+=1){const i=this.getMatchs(t,e.rules[r]);for(let r=0;r<i.length;r+=1){const n=i[r];n.entity=e.name,n.type=e.type,n.utteranceText=t.substring(n.start,n.end+1),n.len=n.utteranceText.length,s.push(n)}}return s}extract(t){const e=t,s=this.getRules(e),r=e.edges||[];for(let t=0;t<s.length;t+=1){const i=this.extractFromRule(e.text||e.utterance,s[t]);for(let t=0;t<i.length;t+=1)r.push(i[t])}return r.sort(((t,e)=>t.start-e.start)),e.edges=Mt(r,!1),e}run(t){const e=t,s=e.locale||"en";return(this.container.get(`extract-regex-${s}`)||this).extract(e)}};const{defaultContainer:Ht}=dt,{TrimType:Zt}=Nt;var Qt=class{constructor(t=Ht){this.container=t.container||t,this.name="extract-trim"}mustSkip(t,e){if(e.options&&e.options.skip&&e.options.skip.length>0)for(let s=0;s<e.options.skip.length;s+=1){const r=e.options.skip[s];if(e.options.caseSensitive){if(r===t)return!0}else if(r.toLowerCase()===t.toLowerCase())return!0}return!1}matchBetween(t,e,s){const r=[];let i;do{const n=e.regex.exec(` ${t} `);if(n){let t,u,o;if(e&&e.options&&e.options.closest){if(t=1,!n[t]){i=!1;break}const e=n[0].indexOf(n[t]);u=n.index-1+e,o=u+n[t].length-1}else t=0,u=n.index-1,o=e.regex.lastIndex-2;r.push({type:"trim",subtype:Zt.Between,start:u,end:o,len:n[t].length,accuracy:1,sourceText:n[t],utteranceText:n[t],entity:s}),i=!0}else i=!1}while(i);const n=[];for(let t=0;t<r.length;t+=1)this.mustSkip(r[t].utteranceText,e)||n.push(r[t]);return n}findWord(t,e,s=!1,r=!1){const i=[];let n;const u=new RegExp(r?e:` ${e} | ${e}|${e} `,s?"g":"ig");do{const e=u.exec(t);e?(i.push({start:e.index,end:u.lastIndex}),n=!0):n=!1}while(n);return i}getBeforeResults(t,e,s){const r=[];let i=0,n=0;for(let u=0;u<e.length;u+=1){n=e[u].start;const o=t.substring(i,n);r.push({type:"trim",subtype:Zt.Before,start:i,end:n-1,len:o.length,accuracy:.99,sourceText:o,utteranceText:o,entity:s}),i=e[u].end}return r}getBeforeFirstResults(t,e,s){const r=[],i=e[0].start,n=t.substring(0,i);return r.push({type:"trim",subtype:Zt.BeforeFirst,start:0,end:i-1,len:n.length,accuracy:.99,sourceText:n,utteranceText:n,entity:s}),r}getBeforeLastResults(t,e,s){const r=[],i=e[e.length-1].start,n=t.substring(0,i);return r.push({type:"trim",subtype:Zt.BeforeLast,start:0,end:i-1,len:n.length,accuracy:.99,sourceText:n,utteranceText:n,entity:s}),r}getAfterResults(t,e,s){const r=[];let i=0,n=t.length;for(let u=e.length-1;u>=0;u-=1){i=e[u].end;const o=t.substring(i,n);r.unshift({type:"trim",subtype:Zt.After,start:i,end:n-1,len:o.length,accuracy:.99,sourceText:o,utteranceText:o,entity:s}),n=e[u].start}return r}getAfterFirstResults(t,e,s){const r=[],i=e[0].end,n=t.length,u=t.substring(i,n);return r.push({type:"trim",subtype:Zt.AfterFirst,start:i,end:n-1,len:u.length,accuracy:.99,sourceText:u,utteranceText:u,entity:s}),r}getAfterLastResults(t,e,s){const r=[],i=e[e.length-1].end,n=t.length,u=t.substring(i,n);return r.push({type:"trim",subtype:Zt.AfterLast,start:i,end:n-1,len:u.length,accuracy:.99,sourceText:u,utteranceText:u,entity:s}),r}getResults(t,e,s,r){switch(s){case Zt.Before:return this.getBeforeResults(t,e,r);case Zt.BeforeFirst:return this.getBeforeFirstResults(t,e,r);case Zt.BeforeLast:return this.getBeforeLastResults(t,e,r);case Zt.After:return this.getAfterResults(t,e,r);case Zt.AfterFirst:return this.getAfterFirstResults(t,e,r);case Zt.AfterLast:return this.getAfterLastResults(t,e,r);default:return[]}}match(t,e,s,r){const i=[];if(e&&Array.isArray(e.words))for(let n=0;n<e.words.length;n+=1){const u=e.options.noSpaces?e.words[n]:` ${e.words[n]}`,o=this.findWord(t,u);if(!e.options.noSpaces){const s=this.findWord(t,e.words[n]);s.length>0&&0===s[0].start&&o.unshift(s[0])}o.length>0&&i.push(...this.getResults(t,o,s,r))}const n=[];for(let t=0;t<i.length;t+=1)i[t].sourceText=i[t].sourceText.replace(/^[\s,.!?;:([\]'"¡¿)/]+|[\s,.!?;:([\]'"¡¿)/]+$/,""),this.mustSkip(i[t].utteranceText,e)||n.push(i[t]);return n}getRules(t){const e=t.nerRules;return e||[]}extractFromRule(t,e){const s=[];for(let r=0;r<e.rules.length;r+=1){const i=e.rules[r];i.type===Zt.Between?s.push(...this.matchBetween(t,i,e.name)):s.push(...this.match(t,i,i.type,e.name))}return s}extract(t){const e=t,s=this.getRules(e),r=e.edges||[];for(let t=0;t<s.length;t+=1){const i=this.extractFromRule(e.text||e.utterance,s[t]);for(let t=0;t<i.length;t+=1)r.push(i[t])}return r.sort(((t,e)=>t.start-e.start)),e.edges=Mt(r,!1),e}run(t){const e=t,s=e.locale||"en";return(this.container.get(`extract-trim-${s}`)||this).extract(e)}};const{defaultContainer:Xt}=dt;var Yt=class{constructor(t=Xt){this.container=t.container||t,this.name="extract-builtin"}extract(t){return t}async run(t){const e=t,s=e.locale||"en",r=this.container.get(`extract-builtin-${s}`)||this,i=await r.extract({text:e.text||e.utterance,locale:e.locale});if(e.edges=e.edges||[],i.edges)for(let t=0;t<i.edges.length;t+=1)e.nerLimitToEntities&&!e.intentEntities.includes(i.edges[t].entity)||e.edges.push(i.edges[t]);if(e.edges=Mt(e.edges,!1),e.sourceEntities=e.sourceEntities||[],i.sourceEntities)for(let t=0;t<i.sourceEntities.length;t+=1)e.sourceEntities.push(i.sourceEntities[t]);return e}};const{Clonable:te}=dt,{TrimType:ee}=Nt;class se extends te{constructor(t={},e=void 0){super({settings:{},container:t.container||e},e),this.applySettings(this.settings,t),this.applySettings(this.settings),this.settings.tag||(this.settings.tag="ner"),this.registerDefault(),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag)),this.rules={},this.applySettings(this,{pipelineProcess:this.getPipeline(`${this.settings.tag}-process`)})}registerDefault(){}getRulesByName(t="*",e="",s=!1){if(!this.rules[t]){if(!s)return;this.rules[t]={}}if(!this.rules[t][e]){if(!s)return;this.rules[t][e]={name:e,type:"enum",rules:[]}}return this.rules[t][e]}addRule(t="*",e,s,r){if(Array.isArray(t))for(let i=0;i<t.length;i+=1)this.addRule(t[i],e,s,r);else this.rules[t]||(this.rules[t]={}),this.rules[t][e]||(this.rules[t][e]={name:e,type:s,rules:[]}),this.rules[t][e].rules.push(r)}asString(t){if(t){if(null!=(e=t)&&e.constructor===Object)return JSON.stringify(t);if(t.toString)return t.toString()}var e;return""}findRule(t,e){const s=this.asString(e);for(let e=0;e<t.length;e+=1)if(this.asString(t[e])===s)return e;return-1}removeRule(t="*",e,s){if(this.rules[t]&&this.rules[t][e])if(s){const r=this.findRule(this.rules[t][e].rules,s);r>-1&&this.rules[t][e].rules.splice(r,1)}else delete this.rules[t][e]}getRules(t="*"){const e=[];if(this.rules[t]){const s=Object.keys(this.rules[t]);for(let r=0;r<s.length;r+=1)e.push(this.rules[t][s[r]])}if("*"!==t&&this.rules["*"]){const t=Object.keys(this.rules["*"]);for(let s=0;s<t.length;s+=1)e.push(this.rules["*"][t[s]])}return e}decideRules(t,e){const s=t;let r=this.getRules(s.locale||"en");if(e&&this.settings.considerOnlyIntentEntities)r=r.filter((t=>e.includes(t.name)));else if(e){const t=[],s=[];r.forEach((r=>{e.includes(r.name)?t.push(r):s.push(r)})),r=t.concat(s)}return s.nerRules=r,s.nerLimitToEntities=this.settings.considerOnlyIntentEntities,s.intentEntities=e,s}getRuleOption(t,e){for(let s=0;s<t.length;s+=1)if(t[s].option===e)return t[s]}addRuleOptionTexts(t,e,s,r){if(Array.isArray(t))for(let i=0;i<t.length;i+=1)this.addRuleOptionTexts(t[i],e,s,r);else{let i=r||s;Array.isArray(i)||(i=[i]);const n=this.getRulesByName(t,e,!0);let u=this.getRuleOption(n.rules,s);if(u){const t={};for(let e=0;e<u.texts.length;e+=1)t[u.texts[e]]=1;for(let e=0;e<i.length;e+=1)t[i[e]]=1;u.texts=Object.keys(t)}else u={option:s,texts:i},n.rules.push(u)}}removeRuleOptionTexts(t,e,s,r){if(Array.isArray(t))for(let i=0;i<t.length;i+=1)this.removeRuleOptionTexts(t[i],e,s,r);else{let i=r||s;Array.isArray(i)||(i=[i]);const n=this.getRulesByName(t,e,!1);if(n){const t=this.getRuleOption(n.rules,s);if(t){const e={};for(let s=0;s<t.texts.length;s+=1)e[t.texts[s]]=1;for(let t=0;t<i.length;t+=1)delete e[i[t]];t.texts=Object.keys(e)}}}}static str2regex(t){const e=t.lastIndexOf("/");return new RegExp(t.slice(1,e),t.slice(e+1))}static regex2str(t){return t.toString()}addRegexRule(t,e,s){const r="string"==typeof s?se.str2regex(s):s,i=r.flags.includes("g")?r:new RegExp(r.source,`${r.flags}g`);this.addRule(t,e,"regex",i)}addBetweenLastCondition(t,e,s,r,i={}){const n={...i,closest:!0};this.addBetweenCondition(t,e,s,r,n)}addBetweenCondition(t,e,s,r,i){const n=i||{},u=Array.isArray(s)?s:[s],o=Array.isArray(r)?r:[r],a=[];for(let t=0;t<u.length;t+=1)for(let e=0;e<o.length;e+=1){const s=!0===n.noSpaces?u[t]:` ${u[t]} `,r=!0===n.noSpaces?o[e]:` ${o[e]} `;let i;i=!0===n.closest?`${s}(?!.*${s}.*)(.*)${r}`:`(?<=${s})(.*)(?=${r})`,a.push(i)}let c=`/${a.join("|")}/g`;!0!==n.caseSensitive&&(c+="i");const l={type:"between",leftWords:u,rightWords:o,regex:se.str2regex(c),options:n};this.addRule(t,e,"trim",l)}addPositionCondition(t,e,s,r,i){const n=i||{},u={type:s,words:Array.isArray(r)?r:[r],options:n};this.addRule(t,e,"trim",u)}addAfterCondition(t,e,s,r){this.addPositionCondition(t,e,ee.After,s,r)}addAfterFirstCondition(t,e,s,r){this.addPositionCondition(t,e,ee.AfterFirst,s,r)}addAfterLastCondition(t,e,s,r){this.addPositionCondition(t,e,ee.AfterLast,s,r)}addBeforeCondition(t,e,s,r){this.addPositionCondition(t,e,ee.Before,s,r)}addBeforeFirstCondition(t,e,s,r){this.addPositionCondition(t,e,ee.BeforeFirst,s,r)}addBeforeLastCondition(t,e,s,r){this.addPositionCondition(t,e,ee.BeforeLast,s,r)}reduceEdges(t){return t.entities=t.edges,delete t.edges,delete t.nerRules,delete t.nerLimitToEntities,delete t.intentEntities,t}async defaultPipelineProcess(t,e){this.cache||(this.cache={extractEnum:this.container.get("extract-enum"),extractRegex:this.container.get("extract-regex"),extractTrim:this.container.get("extract-trim"),extractBuiltin:this.container.get("extract-builtin")},this.cache.extractEnum||(this.container.use(Kt),this.cache.extractEnum=this.container.get("extract-enum")),this.cache.extractRegex||(this.container.use(Gt),this.cache.extractRegex=this.container.get("extract-regex")),this.cache.extractTrim||(this.container.use(Qt),this.cache.extractTrim=this.container.get("extract-trim")),this.cache.extractBuiltin||(this.container.use(Yt),this.cache.extractBuiltin=this.container.get("extract-builtin")));let s=await this.decideRules(t,e);return this.cache.extractEnum&&(s=await this.cache.extractEnum.run(s)),this.cache.extractRegex&&(s=await this.cache.extractRegex.run(s)),this.cache.extractTrim&&(s=await this.cache.extractTrim.run(s)),this.cache.extractBuiltin&&(s=await this.cache.extractBuiltin.run(s)),s=await this.reduceEdges(s),s}async process(t,e){const s={threshold:this.settings.threshold||.8,...t};let r;if(s.locale){const t=this.container.getPipeline(`${this.settings.tag}-${s.locale}-process`);t&&(r=await this.runPipeline(s,t))}else this.pipelineProcess&&(r=await this.runPipeline(s,this.pipelineProcess));return r?e&&(r.entities=r.entities.filter((t=>e.includes(t.entity)))):r=await this.defaultPipelineProcess(s,e),delete r.threshold,r}nameToEntity(t){return`${void 0===this.settings.entityPreffix?"@":this.settings.entityPreffix}${t}${void 0===this.settings.entitySuffix?"":this.settings.entitySuffix}`}entityToName(t){if(!t)return t;let e=t;const s=void 0===this.settings.entityPreffix?"@":this.settings.entityPreffix,r=void 0===this.settings.entitySuffix?"":this.settings.entitySuffix;if(s){if(!e.startsWith(s))return t;e=e.slice(s.length)}if(r){if(!e.endsWith(r))return t;e=e.slice(0,-r.length)}return e}isEntity(t){return this.entityToName(t)!==t}getEntitiesFromUtterance(t,e){e||(e=t,t="es");const s=e.split(/[\s,.!?;:([\]'"¡¿)/]+/).filter((t=>t)),r=[];for(let t=0;t<s.length;t+=1){const e=s[t];this.isEntity(e)&&r.push(this.entityToName(e))}return r}async generateEntityUtterance(t,e){let s={locale:t,utterance:e};s=await this.process(s);const{entities:r}=s;if(!r||!r.length)return e;r.sort(((t,e)=>t.start-e.start));let i=0,n="";for(let t=0;t<r.length;t+=1){const s=r[t],u=e.slice(i,s.start);i=s.end+1,n+=u,n+=this.nameToEntity(s.entity)}return n+=e.slice(r[r.length-1].end+1),n}toJSON(){RegExp.prototype.toJSON=RegExp.prototype.toString;const t={settings:{...this.settings},rules:{...this.rules}};return delete t.settings.container,t}fromJSON(t){this.applySettings(this.settings,t.settings);Object.keys(t.rules).forEach((e=>{Object.keys(t.rules[e]).forEach((s=>{t.rules[e][s].rules="regex"===t.rules[e][s].type?t.rules[e][s].rules.map((t=>se.str2regex(t))):t.rules[e][s].rules.map((t=>"string"==typeof t.regex?{...t,regex:se.str2regex(t.regex)}:t))}))})),this.rules=t.rules}}var re={Ner:se,ExtractorEnum:Kt,ExtractorRegex:Gt,ExtractorTrim:Qt,ExtractorBuiltin:Yt},ie=re.Ner,ne=re.ExtractorEnum,ue=re.ExtractorRegex,oe=re.ExtractorTrim,ae=re.ExtractorBuiltin;return t.ExtractorBuiltin=ae,t.ExtractorEnum=ne,t.ExtractorRegex=ue,t.ExtractorTrim=oe,t.Ner=ie,t.default=re,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
