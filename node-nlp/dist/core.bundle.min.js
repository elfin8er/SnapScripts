this.nlpjs=this.nlpjs||{},this.nlpjs.Core=function(t){"use strict";var e=class{constructor(t,e,i,r,s){this.s_size=t.length,this.s=t,this.substring_i=e,this.result=i,this.method=r,this.instance=s}};const i="\\ud800-\\udfff",r="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\u1ab0-\\u1aff\\u1dc0-\\u1dff",s="\\ufe0e\\ufe0f",n=`[${i}]`,o=`[${r}]`,a="\\ud83c[\\udffb-\\udfff]",c=`[^${i}]`,l="(?:\\ud83c[\\udde6-\\uddff]){2}",h="[\\ud800-\\udbff][\\udc00-\\udfff]",u="\\u200d",g=`${`(?:${o}|${a})`}?`,f=`[${s}]?`,d=f+g+`(?:${u}(?:${[c,l,h].join("|")})${f+g})*`,p=`(?:${[`${c}${o}?`,o,l,h,n].join("|")})`,m=RegExp(`[${u+i+r+s}]`),v=RegExp(`${a}(?=${a})|${p+d}`,"g"),y=t=>m.test(t),b=t=>t.match(v)||[],k=t=>t.split("");var w={hasUnicode:y,unicodeToArray:b,asciiToArray:k,stringToArray:t=>y(t)?b(t):k(t),compareWildcars:function(t,e){const i=`^${e.split("*").map((t=>t.replace(/([.*+^=!:${}()|[\]/\\])/g,"\\$1"))).join(".*")}$`.replace(/\?/g,".");return new RegExp(i).test(t)},loadEnvFromJson:function(t,e={}){const i=Object.keys(e);t=t?`${t}_`:"";for(let r=0;r<i.length;r+=1){const s=`${t}${i[r]}`;process.env[s]=e[i[r]]}}};var C=class{constructor(t){this.container=t.container||t,this.name="default"}getTokenFromWord(t){return t.startsWith("//")?{type:"comment",value:t}:["set","delete","get","inc","dec","eq","neq","gt","ge","lt","le","label","goto","jne","je"].includes(t)?{type:t,arguments:[]}:t.startsWith("$")?{type:"call",value:t.slice(1)}:{type:"reference",value:t}}compile(t){const e=[];for(let i=0;i<t.length;i+=1){const r=t[i].trim().split(" "),s=[];let n,o="";for(let t=0;t<r.length;t+=1){const e=r[t];let i=!1;n?(o=`${o} ${e}`,i=!0,e.endsWith(n)&&(n=void 0,s.push(this.getTokenFromWord(o)))):e.startsWith('"')?(o=e,i=!0,n='"',e.endsWith('"')&&(n=void 0,s.push(this.getTokenFromWord(o)))):e.startsWith("'")&&(o=e,i=!0,n="'",e.endsWith("'")&&(n=void 0,s.push(this.getTokenFromWord(o)))),i||s.push(this.getTokenFromWord(e))}e.push(s)}return e}executeCall(t,e,i,r,s){const n=this.container.getPipeline(t.value);if(!n)throw new Error(`Pipeline $${t.value} not found.`);return this.container.runPipeline(n,i,r,s+1)}executeReference(t,e,i,r,s){const n=this.container.resolvePath(e.value,i,r,s),o=[];for(let e=1;e<t.length;e+=1)o.push(this.container.resolvePathWithType(t[e].value,i,r,s));if(!n)throw new Error(`Method not found for step ${JSON.stringify(t)}`);const a=n.run||n;return"function"==typeof a?"function"==typeof n?a(r,...o):a.bind(n)(r,...o):a}doGoto(t,e){const i=e,r=i.labels[t];i.cursor=r}async executeAction(t,e,i,r,s){let n=t[0];if(n&&n.value&&n.value.startsWith("->")){if(s>0)return i;n={...n},n.value=n.value.slice(2)}switch(n.type){case"set":this.container.setValue(t[1].value,t[2]?t[2].value:void 0,e,i,r);break;case"delete":this.container.deleteValue(t[1].value,e,i,r);break;case"get":return this.container.getValue(t[1]?t[1].value:void 0,e,i,r);case"inc":this.container.incValue(t[1]?t[1].value:void 0,t[2]?t[2].value:"1",e,i,r);break;case"dec":this.container.decValue(t[1]?t[1].value:void 0,t[2]?t[2].value:"1",e,i,r);break;case"eq":this.container.eqValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,i,r);break;case"neq":this.container.neqValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,i,r);break;case"gt":this.container.gtValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,i,r);break;case"ge":this.container.geValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,i,r);break;case"lt":this.container.ltValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,i,r);break;case"le":this.container.leValue(t[1]?t[1].value:void 0,t[2]?t[2].value:void 0,e,i,r);break;case"goto":this.doGoto(t[1].value,e);break;case"jne":e.floating||this.doGoto(t[1].value,e);break;case"je":e.floating&&this.doGoto(t[1].value,e);break;case"call":return this.executeCall(n,e,i,r,s);case"reference":return this.executeReference(t,n,e,i,r)}return i}findLabels(t,e){const i=e;for(let e=0;e<t.length;e+=1){const r=t[e];"label"===r[0].type&&(i[r[1].value]=e)}}async execute(t,e,i,r){let s=e;const n={cursor:0,labels:{}};for(this.findLabels(t,n.labels);n.cursor<t.length;)s=await this.executeAction(t[n.cursor],n,s,i,r),n.cursor+=1;return s}};var P=new class{constructor(){this.name="logger"}debug(...t){console.debug(...t)}info(...t){console.info(...t)}warn(...t){console.warn(...t)}error(...t){console.error(...t)}log(...t){console.log(...t)}trace(...t){console.trace(...t)}fatal(...t){console.error(...t)}};const{compareWildcars:S}=w;class ${constructor(t=!1){this.classes={},this.factory={},this.pipelines={},this.configurations={},this.compilers={},this.cache={bestKeys:{},pipelines:{}},this.registerCompiler(C),t||this.use(P)}registerCompiler(t,e){const i=new t(this);this.compilers[e||i.name]=i}addClass(t,e){this.classes[e||t.name]=t}toJSON(t){const e=t.toJSON?t.toJSON():{...t};return e.className=t.constructor.name,e}fromJSON(t,e){const i=this.classes[t.className];let r;return i?(r=new i(e),r.fromJSON?r.fromJSON(t):Object.assign(r,t)):r={...t},delete r.className,r}register(t,e,i=!0){this.cache.bestKeys={};const r="function"==typeof e,s={name:t,isSingleton:i};s.instance=i?r?new e:e:r?e:e.constructor,this.factory[t]=s}getBestKey(t){if(void 0!==this.cache.bestKeys[t])return this.cache.bestKeys[t];const e=Object.keys(this.factory);for(let i=0;i<e.length;i+=1)if(S(t,e[i]))return this.cache.bestKeys[t]=e[i],e[i];this.cache.bestKeys[t]=null}get(t,e){let i=this.factory[t];if(!i){if(this.parent)return this.parent.get(t,e);const r=this.getBestKey(t);if(r&&(i=this.factory[r]),!i)return}if(i.isSingleton)return i.instance&&i.instance.applySettings&&i.instance.applySettings(i.instance.settings,e),i.instance;return new(0,i.instance)(e,this)}buildLiteral(t,e,i,r){return{type:"literal",subtype:t,src:e,value:i,context:r,container:this}}resolvePathWithType(t,e,i,r){const s=t.split(".");let n=s[0].trim();n||(n=t.startsWith(".")?"this":"context");if(/^\d+$/.test(n))return this.buildLiteral("number",t,parseFloat(n),e);if(n.startsWith('"'))return this.buildLiteral("string",t,n.replace(/^"(.+(?="$))"$/,"$1"),e);if(n.startsWith("'"))return this.buildLiteral("string",t,n.replace(/^'(.+(?='$))'$/,"$1"),e);if("true"===n)return this.buildLiteral("boolean",t,!0,e);if("false"===n)return this.buildLiteral("boolean",t,!1,e);let o=e;"input"===n||"output"===n?o=i:n&&"context"!==n&&"this"!==n?o=this.get(n)||o[n]:"this"===n&&(o=r);for(let e=1;e<s.length;e+=1){const i=s[e];if((!o||!o[i])&&e<s.length-1)throw Error(`Path not found in pipeline "${t}"`);const r=o;o=o[i],"function"==typeof o&&(o=o.bind(r))}return"function"==typeof o?{type:"function",src:t,value:o,context:e,container:this}:{type:"reference",src:t,value:o,context:e,container:this}}resolvePath(t,e,i,r){const s=this.resolvePathWithType(t,e,i,r);return s?s.value:s}setValue(t,e,i,r,s){const n=this.resolvePath(e,i,r,s),o=t.split("."),a=o.slice(0,-1).join(".");this.resolvePath(a,i,r,s)[o[o.length-1]]=n}incValue(t,e,i,r,s){const n=this.resolvePath(e,i,r,s),o=t.split(".");t.startsWith(".")&&o.push("this");const a=o.slice(0,-1).join(".");this.resolvePath(a,i,r,s)[o[o.length-1]]+=n}decValue(t,e,i,r,s){const n=this.resolvePath(e,i,r,s),o=t.split("."),a=o.slice(0,-1).join(".");this.resolvePath(a,i,r,s)[o[o.length-1]]-=n}eqValue(t,e,i,r,s){const n=i,o=this.resolvePath(t,n,r,s),a=this.resolvePath(e,n,r,s);n.floating=o===a}neqValue(t,e,i,r,s){const n=i,o=this.resolvePath(t,n,r,s),a=this.resolvePath(e,n,r,s);n.floating=o!==a}gtValue(t,e,i,r,s){const n=i,o=this.resolvePath(t,n,r,s),a=this.resolvePath(e,n,r,s);n.floating=o>a}geValue(t,e,i,r,s){const n=i,o=this.resolvePath(t,n,r,s),a=this.resolvePath(e,n,r,s);n.floating=o>=a}ltValue(t,e,i,r,s){const n=i,o=this.resolvePath(t,n,r,s),a=this.resolvePath(e,n,r,s);n.floating=o<a}leValue(t,e,i,r,s){const n=i,o=this.resolvePath(t,n,r,s),a=this.resolvePath(e,n,r,s);n.floating=o<=a}deleteValue(t,e,i,r){const s=t.split("."),n=s.slice(0,-1).join(".");delete this.resolvePath(n,e,i,r)[s[s.length-1]]}getValue(t,e,i,r){const s=(t||"floating").split("."),n=s.slice(0,-1).join(".");return this.resolvePath(n,e,i,r)[s[s.length-1]]}async runPipeline(t,e,i,r=0){if(r>10)throw new Error("Pipeline depth is too high: perhaps you are using recursive pipelines?");const s="string"==typeof t?this.getPipeline(t):t;if(!s)throw new Error(`Pipeline not found ${t}`);if(!s.compiler){const t=JSON.stringify(s);this.registerPipeline(t,s,!1);const n=this.getPipeline(t);return n.compiler.execute(n.compiled,e,i,r)}return s.compiler.execute(s.compiled,e,i,r)}use(t,e,i,r=!1){let s;if("function"==typeof t){if(t.name.endsWith("Compiler"))return this.registerCompiler(t),t.name;s=new t({container:this})}else s=t;s.register&&s.register(this);const n=s.settings?s.settings.tag:void 0,o=e||s.name||n||t.name||s.constructor.name;return r&&this.get(o)||this.register(o,s,i),o}getCompiler(t){const e=this.compilers[t];return e||(this.parent?this.parent.getCompiler(t):this.compilers.default)}buildPipeline(t,e=[]){const i=[];if(t&&t.length>0)for(let r=0;r<t.length;r+=1){const s=t[r];if("$super"===s.trim())for(let t=0;t<e.length;t+=1){e[t].trim().startsWith("->")||i.push(e[t])}else i.push(s)}const r=i.length&&i[0].startsWith("// compiler=")?i[0].slice(12):"default",s=this.getCompiler(r),n=s.compile(i);return{pipeline:i,compiler:s,compiled:n}}registerPipeline(t,e,i=!0){if(i||!this.pipelines[t]){this.cache.pipelines={};const i=this.getPipeline(t);this.pipelines[t]=this.buildPipeline(e,i?i.pipeline:[])}}registerPipelineForChilds(t,e,i,r=!0){this.childPipelines||(this.childPipelines={}),this.childPipelines[t]||(this.childPipelines[t]=[]),this.childPipelines[t].push({tag:e,pipeline:i,overwrite:r})}getPipeline(t){if(this.pipelines[t])return this.pipelines[t];if(void 0!==this.cache.pipelines[t])return this.cache.pipelines[t]||void 0;const e=Object.keys(this.pipelines);for(let i=0;i<e.length;i+=1)if(S(t,e[i]))return this.cache.pipelines[t]=this.pipelines[e[i]],this.pipelines[e[i]];this.cache.pipelines[t]=null}registerConfiguration(t,e,i=!0){!i&&this.configurations[t]||(this.configurations[t]=e)}getConfiguration(t){if(this.configurations[t])return this.configurations[t];const e=Object.keys(this.configurations);for(let i=0;i<e.length;i+=1)if(S(t,e[i]))return this.configurations[e[i]]}loadPipelinesFromString(t=""){const e=t.split(/\n|\r|\r\n/);let i="",r=[],s="";for(let t=0;t<e.length;t+=1){const n=e[t];""!==n&&(n.startsWith("# ")?(i&&(s&&!["default","pipelines"].includes(s.toLowerCase())?this.registerPipelineForChilds(s,i,r):this.registerPipeline(i,r)),s=n.slice(1).trim(),i="",r=[]):n.startsWith("## ")?(i&&(s&&!["default","pipelines"].includes(s.toLowerCase())?this.registerPipelineForChilds(s,i,r):this.registerPipeline(i,r)),i=n.slice(2).trim(),r=[]):i&&r.push(n))}i&&(s&&!["default","pipelines"].includes(s.toLowerCase())?this.registerPipelineForChilds(s,i,r):this.registerPipeline(i,r))}async start(t="main"){const e=Object.keys(this.factory);for(let t=0;t<e.length;t+=1){const i=this.factory[e[t]];i.isSingleton&&i.instance&&i.instance.start&&await i.instance.start()}this.getPipeline(t)&&await this.runPipeline(t,{},this)}}const T=new $;var j={Container:$,defaultContainer:T};const{defaultContainer:z}=j;class A{constructor(t=z){this.container=t.container||t,this.name="arrToObj"}static arrToObj(t){const e={};for(let i=0;i<t.length;i+=1)e[t[i]]=1;return e}run(t){return Array.isArray(t)?A.arrToObj(t):(t.tokens=A.arrToObj(t.tokens),t)}}var O=A;const{defaultContainer:_}=j;var W=class{constructor(t=_){this.container=t.container||t,this.name="normalize"}normalize(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}run(t){const e=t,i=e.locale||"en",r=this.container.get(`normalizer-${i}`)||this;return e.text=r.normalize(e.text,e),e}};const{defaultContainer:x}=j;var N=class{constructor(t=x,e=!1){this.container=t.container||t,this.name="tokenize",this.shouldNormalize=e}getNormalizer(){return this.normalizer||(this.normalizer=this.container.get(`normalizer-${this.name.slice(-2)}`)||new W),this.normalizer}normalize(t,e){if(void 0===e&&this.shouldNormalize||!0===e){return this.getNormalizer().normalize(t)}return t}innerTokenize(t){return t.split(/[\s,.!?;:([\]'"¡¿)/]+/).filter((t=>t))}tokenize(t,e){let i;if(this.cache){const t=new Date;Math.abs(t.getTime()-this.cache.created)/36e5>1&&(this.cache=void 0)}if(this.cache){if(e?Object.prototype.hasOwnProperty.call(this.cache.normalized,t)&&(i=this.cache.normalized[t]):Object.prototype.hasOwnProperty.call(this.cache.nonNormalized,t)&&(i=this.cache.nonNormalized[t]),i)return i}else this.cache={created:(new Date).getTime(),normalized:{},nonNormalized:{}};return i=this.innerTokenize(this.normalize(t,e),e),e?this.cache.normalized[t]=i:this.cache.nonNormalized[t]=i,i}async run(t){const e=t,i=e.locale||"en";let r=this.container.get(`tokenizer-${i}`);if(!r){const t=this.container.get("tokenizer-bert");r=t&&t.activeFor(i)?t:this}const s=await r.tokenize(e.text,e);return e.tokens=s.filter((t=>t)),e}};const{defaultContainer:V}=j;var E=class{constructor(t=V,e){this.container=t.container||t,this.cache={},this.setCurrent(""),this.dictionary=e||{before:{},after:{}}}setCurrent(t){this.current=t,this.cursor=0,this.limit=this.current.length,this.limit_backward=0,this.bra=this.cursor,this.ket=this.limit}getCurrent(){return this.current}bc(t,e){return 0==(t[e>>>3]&1<<(7&e))}in_grouping(t,e,i){if(this.cursor>=this.limit)return!1;let r=this.current.charCodeAt(this.cursor);return!(r>i||r<e)&&(r-=e,!this.bc(t,r)&&(this.cursor++,!0))}in_grouping_b(t,e,i){if(this.cursor<=this.limit_backward)return!1;let r=this.current.charCodeAt(this.cursor-1);return!(r>i||r<e)&&(r-=e,!this.bc(t,r)&&(this.cursor--,!0))}out_grouping(t,e,i){if(this.cursor>=this.limit)return!1;let r=this.current.charCodeAt(this.cursor);return r>i||r<e?(this.cursor++,!0):(r-=e,!!this.bc(t,r)&&(this.cursor++,!0))}out_grouping_b(t,e,i){if(this.cursor<=this.limit_backward)return!1;let r=this.current.charCodeAt(this.cursor-1);return r>i||r<e?(this.cursor--,!0):(r-=e,!!this.bc(t,r)&&(this.cursor--,!0))}eq_s(t,e){return"string"==typeof t&&(t=(e=t).length),!(this.limit-this.cursor<t||this.current.slice(this.cursor,this.cursor+t)!=e)&&(this.cursor+=t,!0)}eq_s_b(t,e){return"string"==typeof t&&(t=(e=t).length),!(this.cursor-this.limit_backward<t||this.current.slice(this.cursor-t,this.cursor)!=e)&&(this.cursor-=t,!0)}find_among(t,e){let i=0,r=e||t.length;const s=this.cursor,n=this.limit;let o=0,a=0,c=!1;for(;;){const e=i+(r-i>>>1);let u=0,g=o<a?o:a;var l,h=t[e];for(l=g;l<h.s_size;l++){if(s+g==n){u=-1;break}if(u=this.current.charCodeAt(s+g)-h.s.charCodeAt(l),0!=u)break;g++}if(u<0?(r=e,a=g):(i=e,o=g),r-i<=1){if(i>0)break;if(r==i)break;if(c)break;c=!0}}for(;;){if(o>=(h=t[i]).s_size){if(this.cursor=s+h.s_size,null==h.method)return h.result;const t=h.method(h.instance);if(this.cursor=s+h.s_size,t)return h.result}if(i=h.substring_i,i<0)return 0}return-1}find_among_b(t,e){let i=0,r=e||t.length;const s=this.cursor,n=this.limit_backward;let o=0,a=0,c=!1;for(;;){const e=i+(r-i>>1);let u=0,g=o<a?o:a;var l;for(l=(h=t[e]).s_size-1-g;l>=0;l--){if(s-g==n){u=-1;break}if(u=this.current.charCodeAt(s-1-g)-h.s.charCodeAt(l),0!=u)break;g++}if(u<0?(r=e,a=g):(i=e,o=g),r-i<=1){if(i>0)break;if(r==i)break;if(c)break;c=!0}}for(;;){var h;if(o>=(h=t[i]).s_size){if(this.cursor=s-h.s_size,null==h.method)return h.result;const t=h.method(this);if(this.cursor=s-h.s_size,t)return h.result}if(i=h.substring_i,i<0)return 0}return-1}replace_s(t,e,i){const r=i.length-(e-t);return this.current=this.current.slice(0,t)+i+this.current.slice(e),this.limit+=r,this.cursor>=e?this.cursor+=r:this.cursor>t&&(this.cursor=t),r}slice_check(){return!(this.bra<0||this.bra>this.ket||this.ket>this.limit||this.limit>this.current.length)}slice_from(t){return!!this.slice_check()&&(this.replace_s(this.bra,this.ket,t),!0)}slice_del(){return this.slice_from("")}insert(t,e,i){const r=this.replace_s(t,e,i);t<=this.bra&&(this.bra+=r),t<=this.ket&&(this.ket+=r)}slice_to(t){let e="";return this.slice_check()&&(e=this.current.slice(this.bra,this.ket)),e}stemWord(t){let e=this.cache[`.${t}`];return null==e&&(this.dictionary.before.hasOwnProperty(t)?e=this.dictionary.before[t]:(this.setCurrent(t),this.innerStem(),e=this.getCurrent(),this.dictionary.after.hasOwnProperty(e)&&(e=this.dictionary.after[e])),this.cache[`.${t}`]=e),e}stemWords(t){const e=[];for(let i=0;i<t.length;i++){const r=this.stemWord(t[i]);r&&e.push(r.trim())}return e}stem(t){return null==t?t:Array.isArray(t)?this.stemWords(t):this.stemWords([t])[0]}getTokenizer(){return this.tokenizer||(this.tokenizer=this.container.get(`tokenizer-${this.name.slice(-2)}`)||new N),this.tokenizer}getStopwords(){return this.stopwords||(this.stopwords=this.container.get(`tokenizer-${this.name.slice(-2)}`)),this.stopwords}tokenizeAndStem(t,e=!0){let i=this.getTokenizer().tokenize(t,!0);if(!e){const t=this.getStopwords();t&&(i=t.removeStopwords(i))}return this.stemWords(i)}};const{defaultContainer:F}=j;class J{constructor(t=F){this.container=t.container||t,this.name="objToArr"}static objToArr(t){return Object.keys(t)}run(t){return t.tokens?(t.tokens=J.objToArr(t.tokens),t):J.objToArr(t)}}var L=J;const{defaultContainer:q}=j;var B=class{constructor(t=q){this.container=t.container||t,this.name="stem"}stem(t){return t}getStemmer(t){const e=t,i=e.locale||e.settings&&e.settings.locale||"en";let r=this.container.get(`stemmer-${i}`);if(!r){const t=this.container.get("stemmer-bert");r=t&&t.activeFor(i)?t:this}return r}async addForTraining(t){const e=this.getStemmer(t);return e.addUtterance&&await e.addUtterance(t.utterance,t.intent),t}async train(t){const e=this.getStemmer(t);return e.innerTrain&&await e.innerTrain(),t}async run(t){const e=t,i=this.getStemmer(e);return e.tokens=await i.stem(e.tokens,e),e}};const{defaultContainer:K}=j;var M=class{constructor(t=K){this.container=t.container||t,this.name="removeStopwords",this.dictionary={}}build(t){for(let e=0;e<t.length;e+=1)this.dictionary[t[e]]=!0}isNotStopword(t){return!this.dictionary[t]}isStopword(t){return!!this.dictionary[t]}removeStopwords(t){return t.filter((t=>this.isNotStopword(t)))}run(t){if(t.settings&&!1===t.settings.keepStopwords){const e=t,i=e.locale||"en",r=this.container.get(`stopwords-${i}`)||this;return e.tokens=r.removeStopwords(e.tokens,e).filter((t=>t)),e}return t}};const{defaultContainer:U}=j;var D=class{constructor(t=U){this.container=t.container||t,this.name="timer"}start(t){return t&&(t.hrstart=new Date),t}stop(t){const e=t;if(e&&e.hrstart){const t=new Date;e.elapsed=t.getTime()-e.hrstart.getTime(),delete e.hrstart}return e}run(t){this.start(t)}};const{defaultContainer:I}=j;var R=class{constructor(t={},e=I){this.container=t.container||e,this.applySettings(this,t)}get logger(){return this.container.get("logger")}applySettings(t,e={}){const i=t||{};return Object.keys(e).forEach((t=>{void 0===i[t]&&(i[t]=e[t])})),i}toJSON(){const t=this.jsonExport||{},e={},i=Object.keys(this);for(let r=0;r<i.length;r+=1){const s=i[r];if("jsonExport"!==s&&"jsonImport"!==s&&"container"!==s&&!s.startsWith("pipeline")){const i=void 0===t[s]||t[s];if("function"==typeof i){const t=i.bind(this)(e,this,s,this[s]);t&&(e[s]=t)}else"boolean"==typeof i?i&&(e[s]=this[s],"settings"===s&&delete e[s].container):"string"==typeof i&&(e[i]=this[s])}}return e}fromJSON(t){const e=this.jsonImport||{},i=Object.keys(t);for(let r=0;r<i.length;r+=1){const s=i[r],n=void 0===e[s]||e[s];if("function"==typeof n){const e=n.bind(this)(this,t,s,t[s]);e&&(this[s]=e)}else"boolean"==typeof n?n&&(this[s]=t[s]):"string"==typeof n&&(this[n]=t[s])}}objToValues(t,e){const i=e||Object.keys(t),r=[];for(let e=0;e<i.length;e+=1)r.push(t[i[e]]);return r}valuesToObj(t,e){const i={};for(let r=0;r<t.length;r+=1)i[e[r]]=t[r];return i}getPipeline(t){return this.container.getPipeline(t)}async runPipeline(t,e){return this.container.runPipeline(e||this.pipeline,t,this)}use(t){this.container.use(t)}};const{defaultContainer:G}=j;var H=class extends R{constructor(t={},e=void 0){super({settings:{},container:t.container||e||G},e),this.applySettings(this.settings,t),this.applySettings(this.settings,{etag:1,memory:{}}),this.settings.tag||(this.settings.tag="storage"),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag))}read(t){return new Promise((e=>{const i={};Array.isArray(t)||(t=[t]),t.forEach((t=>{const e=this.settings.memory[t];e&&(i[t]=JSON.parse(e))})),e(i)}))}saveItem(t,e){const i={...e};return i.eTag=this.settings.etag.toString(),this.settings.etag+=1,this.settings.memory[t]=JSON.stringify(i),i}write(t){return new Promise(((e,i)=>{Object.keys(t).forEach((r=>{const s=t[r],n=this.settings.memory[r];if(!n||"*"===s.eTag)return e(this.saveItem(r,s));const o=JSON.parse(n);return s.eTag!==o.eTag?i(new Error(`Error writing "${r}" due to eTag conflict.`)):e(this.saveItem(r,s))}))}))}delete(t){return new Promise((e=>{t.forEach((t=>delete this.settings.memory[t])),e()}))}};var Q={readFile:function(){return new Promise((t=>{t(void 0)}))},writeFile:function(){return new Promise(((t,e)=>{e(new Error("File cannot be written in web"))}))},existsSync:function(){return!1},lstatSync:function(){},readFileSync:function(){},name:"fs"};const{Container:X}=j,{loadEnvFromJson:Y}=w;function Z(t,e){if("string"==typeof t)return t.startsWith("$")?process.env[`${e}${t.slice(1)}`]||process.env[t.slice(1)]:t;if(Array.isArray(t))return t.map((t=>Z(t,e)));if("object"==typeof t){const i=Object.keys(t),r={};for(let s=0;s<i.length;s+=1)r[i[s]]=Z(t[i[s]],e);return r}return t}var tt=function(t,e,i,r,s,n){const o=t||{},a=i||new X(r);a.parent=n,r||(a.register("fs",Q),a.use(O),a.use(W),a.use(L),a.use(B),a.use(M),a.use(N),a.use(D),a.use(P),a.use(H));const c=o;let l;if(o.env&&Y(r,o.env),l=c,l=Z(l,r?`${r}_`:""),l.settings){const t=Object.keys(l.settings);for(let e=0;e<t.length;e+=1)a.registerConfiguration(t[e],l.settings[t[e]],!0)}if(l.use)for(let t=0;t<l.use.length;t+=1){const e=l.use[t];Array.isArray(e)?a.register(e[0],e[1]):a.use(e)}if(l.terraform)for(let t=0;t<l.terraform.length;t+=1){const e=l.terraform[t],i=a.get(e.className);a.register(e.name,i,!0)}if(l.childs&&(a.childs=l.childs),s)for(let t=0;t<s.length;t+=1){const e=s[t];a.registerPipeline(e.tag,e.pipeline,e.overwrite)}return l.pipelines&&function(t,e){t.loadPipelinesFromString(e)}(a,l.pipelines),a};var et=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return`${t()+t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`};const it=new class{constructor(){this.containers={}}getContainer(t){return this.containers[t||"default"]}async createContainer(t,e,i,r,s,n){const o=void 0===i||i;if("string"!=typeof t&&(e=t,t=""),e||"default"!==t&&""!==t||(e="conf.json"),!this.containers[t]){const i=tt(e,o,void 0,r,n);i.name=t,this.containers[t]=i,i.dock=this,i.parent=s,await i.start(),i.childs&&await this.buildChilds(i)}return this.containers[t]}async buildChilds(t){if(t&&t.childs){const e=Object.keys(t.childs),i={};for(let r=0;r<e.length;r+=1){const s=t.childs[e[r]];s.isChild=!0,s.pathPipeline||(s.pathPipeline=`${e[r]}_pipeline.md`),i[e[r]]=await this.createContainer(e[r],s,!1,e[r],t,t.childPipelines?t.childPipelines[e[r]]:void 0)}t.childs=i}}async terraform(t,e=!0){return await this.createContainer("default",t,e,"")}start(t,e=!0){return this.terraform(t,e)}};var rt=it;const{defaultContainer:st}=j;var nt=class extends R{constructor(t={},e=void 0){super({settings:{},container:t.container||e||st},e),this.applySettings(this.settings,t),this.settings.tag||(this.settings.tag="context"),this.applySettings(this.settings,this.container.getConfiguration(this.settings.tag))}getStorage(){const t=this.container.get(this.settings.storageName||"storage");if(!t)throw new Error("Storage not found");return t}getContext(t){return this.getStorage().read(`${this.settings.tag}-${t}`)}setContext(t,e){const i={[t]:e};return this.getStorage().write(i)}async getContextValue(t,e){const i=await this.getContext(t);return i?i[e]:void 0}async setContextValue(t,e,i){let r=await this.getContext(t);return r||(r={}),r[e]=i,this.setContext(t,r)}};const{Container:ot,defaultContainer:at}=j,{hasUnicode:ct,unicodeToArray:lt,asciiToArray:ht,stringToArray:ut,compareWildcars:gt,loadEnv:ft}=w;var dt={Among:e,ArrToObj:O,BaseStemmer:E,containerBootstrap:tt,Clonable:R,Container:ot,defaultContainer:at,hasUnicode:ct,unicodeToArray:lt,asciiToArray:ht,stringToArray:ut,compareWildcars:gt,loadEnv:ft,Normalizer:W,ObjToArr:L,Stemmer:B,Stopwords:M,Tokenizer:N,Timer:D,logger:P,MemoryStorage:H,uuid:et,dock:rt,Context:nt,dockStart:async function(t,e){return await rt.start(t,e),rt}},pt=dt.Among,mt=dt.ArrToObj,vt=dt.BaseStemmer,yt=dt.containerBootstrap,bt=dt.Clonable,kt=dt.Container,wt=dt.defaultContainer,Ct=dt.hasUnicode,Pt=dt.unicodeToArray,St=dt.asciiToArray,$t=dt.stringToArray,Tt=dt.compareWildcars,jt=dt.loadEnv,zt=dt.Normalizer,At=dt.ObjToArr,Ot=dt.Stemmer,_t=dt.Stopwords,Wt=dt.Tokenizer,xt=dt.Timer,Nt=dt.logger,Vt=dt.MemoryStorage,Et=dt.uuid,Ft=dt.dock,Jt=dt.Context,Lt=dt.dockStart;return t.Among=pt,t.ArrToObj=mt,t.BaseStemmer=vt,t.Clonable=bt,t.Container=kt,t.Context=Jt,t.MemoryStorage=Vt,t.Normalizer=zt,t.ObjToArr=At,t.Stemmer=Ot,t.Stopwords=_t,t.Timer=xt,t.Tokenizer=Wt,t.asciiToArray=St,t.compareWildcars=Tt,t.containerBootstrap=yt,t.default=dt,t.defaultContainer=wt,t.dock=Ft,t.dockStart=Lt,t.hasUnicode=Ct,t.loadEnv=jt,t.logger=Nt,t.stringToArray=$t,t.unicodeToArray=Pt,t.uuid=Et,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
